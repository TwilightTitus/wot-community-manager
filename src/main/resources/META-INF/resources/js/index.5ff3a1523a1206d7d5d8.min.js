(()=>{var t={609:()=>{String.prototype.hashcode||(String.prototype.hashcode=function(){if(0===this.length)return 0;let t=0;const e=this.length;for(let n=0;n<e;n++){t=(t<<5)-t+this.charCodeAt(n),t|=0}return t})},923:()=>{const t=document.body,e=/[^a-z0-9-_]/i,n="filterable-by",a="filterable-item-filter-mismatched",i=new WeakMap,r=t=>{const r=null!=t.attr("active"),s=t.find(t.attr("filterable-item-container-selector")).first(),o=(t.attr("filter-content-selector")||"[filterable-item]").trim(),c=(t.attr(n)||"").trim().toLowerCase().replace(e,"_"),l=(t.attr("filterable-by-value")||"").trim().toLowerCase(),u=`${n}--${c}`,h=`[${u}]`,d=`${c}::${l}`;s.find(o).forEach((t=>{const e=(t=>{let e=i.get(t);return null!=e&&void 0!==e||(e=new Map,i.set(t,e)),e})(t);if(r)e.delete(d);else{const n=((t,e,n)=>{if(t.is(e))return t.attr(n);const a=t.find(e).first();return a?a.attr(n):null})(t,h,u);null!=n&&n.trim().toLowerCase()==l||e.set(d,!0)}0!=e.size?t.addClass(a):t.removeClass(a)})),t.toggleAttribute("active")};t.on("mixin-filterable:action:filter-by",(t=>{t.stopPropagation(),r(t.target)}))},576:()=>{const t=document.body,e="searchable-item",n="searchable-content",a=`:not([${e}]) [${e}]`,i=`[${n}]`,r="searchable-item-mismatched",s=t=>{const e=(t.value||"").trim().toLowerCase(),s=t.find(t.attr("searchable-item-container-selector")).first(),o=(t.attr("searchable-item-selector")||a).trim();if(s.find(o).removeClass(r),e.length>0){const t=e.split(/\s+/);s.find(o).forEach((e=>{const a=(t=>{const e=Array.from(t.find(i)||[]);return t.is(i)&&e.push(t),e.map((t=>t.attr(n)||"")).join(" ").toLowerCase()})(e);t.some((t=>a.search(t)<0))&&e.addClass(r)}))}};let o=null;t.on("mixin-searchable:action:search",(t=>{t.stopPropagation();const e=t.target;o&&clearTimeout(o),o=setTimeout((()=>s(e)),250)}))},23:()=>{const t=document.body,e="sortable-by",n=(t,e,n)=>(t=((t,e)=>t?t.is(e)?t:t.find(e).first()||null:null)(t,n),null!=t?t.attr(e):null);t.on("mixin-sortable:action:sort-by",(t=>{t.stopPropagation();const a=t.target,i=a.find(a.attr("sortable-item-container-selector")).first(),r=`${e}--${a.attr(e)}`,s=`[${r}]`,o=(a.attr("sortable-direction")||"").trim().toLowerCase();if(!i)return;const c=Array.from(i.children).sort(((t,e)=>{const a=(n(t,r,s)||"").toLowerCase(),i=(n(e,r,s)||"").toLowerCase();return a<i?-1:a>i?1:0}));o&&"desc"===o&&c.reverse(),i.empty().append(c)}))}},e={};function n(a){var i=e[a];if(void 0!==i)return i.exports;var r=e[a]={exports:{}};return t[a](r,r.exports,n),r.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";const t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},e=t.fetch,a=t.location.origin;const i=new class{#t={};#e={};#n={};#a=!1;#i=[];#r=[];#s;constructor(){}set ignoreDocumentOrigin(t){this.#a=t}addOriginToIgnore(t){if(t instanceof Array)for(let e of t)this.#n[e.toString()]=!0;else this.#n[t.toString()]=!0}addUrlToIgnore(t){if(t instanceof Array)for(let e of t)this.#e[e.toString()]=!0;else this.#e[t.toString()]=!0}setup(t){("function"==typeof t||t instanceof Promise)&&this.#r.push(t)}addInterceptor(t){if(t instanceof Array)return t.forEach((t=>this.addInterceptor(t)));if("object"!=typeof t)throw new Error("function required an interceptor");if("function"!=typeof t.doAccept)throw new Error('The interceptor required a "doAccept" function!');if("function"!=typeof t.doHandle)throw new Error('The interceptor required a "doHandle" function!');this.#i.push(t),this.reset()}get ready(){return(async()=>0==this.#r.length||(this.#s||(this.#s=(async()=>{for(;0!=this.#r.length;){const t=this.#r[0];if(t){const e=t instanceof Promise?await t:await t();e&&(e instanceof Array?e.forEach((t=>this.addInterceptor(t))):this.addInterceptor(e))}this.#r.shift()}return this.#s=null,this.ready})()),this.#s))()}async doIntercept(t){await this.ready;const e=t.metadata.origin;if(this.#o(e,t.url.toString()))return t;const{url:n,metadata:a}=t,i=await this.#c(e,{url:n,metadata:a});if(!i)return t;for(let e of i)t=await e.doHandle(t);return t}reset(){this.#t={}}async uncheckedFetch(t,n){return e(t,n)}#o(t,e){return!!this.#e[e]||(!(!this.#a||t!=a)||!!this.#n[t])}async#c(t,e){let n=this.#t[t];return n||(n=this.#l(t,e),this.#t[t]=n),n}async#l(t,e){const n=[];for(let t of this.#i)await t.doAccept(e)&&n.push(t);return n}};setTimeout((()=>i.ready),10);const r=i;if(void 0!==t.XMLHttpRequest){const e=t.XMLHttpRequest,n=function(t){e.prototype.open.call(this,t.request.method,t.url,t.metadata.async,t.metadata.username,t.metadata.password),void 0!==t.request.headers&&Object.getOwnPropertyNames(t.request.headers).forEach((n=>{e.prototype.setRequestHeader.call(this,n,t.request.headers[n])})),e.prototype.send.call(this,t.request.body)},a=function(){const a=new e(arguments);let i;return a.setRequestHeader=function(t,e){i.request.headers=i.request.headers||{},i.request.headers[t]=e},a.open=function(e,n,a,r,s){const o=new URL(n,t.location.origin);i={url:new URL(n,location),request:{method:e},metadata:{method:e,origin:o.origin,protocol:o.protocol,hostname:o.hostname,port:o.port,path:o.pathname,query:o.search,hash:o.hash,async:"boolean"!=typeof a||a,username:r,password:s}}},a.send=function(t){i.metadata.async?(i.request.body=t,r.doIntercept(i).then(n.bind(a)).catch(console.error)):n.call(a,i)},a};t.XMLHttpRequest=a,t.XMLHttpRequest.prototype=e.prototype,t.XMLHttpRequest.prototype.constructor=a}t.fetch=async function(n,a){const i=new URL(n,t.location),s=await r.doIntercept({url:new URL(n,location),request:a||{},metadata:{method:void 0===a?"GET":a.method||"GET",origin:i.origin,protocol:i.protocol,hostname:i.hostname,port:i.port,path:i.pathname,hash:i.hash,query:i.search,async:!0}});return e(s.url,s.request)};class s{async doAccept(t){}async doHandle(t){}async unceckedFetch(t,n){return e(t,n)}}const o=async(t,e)=>(e.request.headers=e.request.headers||{},e.request.headers.Authorization=`Bearer ${t}`,e);class c extends s{#u=null;#h={};#d;#p;#f;#g;#m;constructor({condition:t,fetchToken:e,appendToken:n,refreshInterval:a=6e4,refreshToken:i}){if(super(),"string"!=typeof t&&!(t instanceof Array)&&"function"!=typeof t)throw new Error('Parameter "condition" must be a "string", "array" or "function"!');if(this.#d=t,"function"!=typeof e)throw new Error('Parameter "fetchToken" must be a "function"!');if(this.#p=e,n&&"function"!=typeof n)throw new Error('Parameter "appendToken" must be a "function"!');this.#f=n||o,this.#g=a,this.#m=i}async doAccept(t){const e=typeof this.#d,n=this.#d,a=t.metadata.origin;return"function"===e?await n(t):"string"===e?n==a:n instanceof Array&&n.includes(a)}async doHandle(t){if(!this.#u){const{url:e,metadata:n}=t;this.#h={url:e,metadata:n},this.#u=this.#p({url:e,metadata:n}),this.#y()}return this.#w(t)}async#w(t){const e=this.#f,n=await this.#u,a=await e(n,t);return a||t}#y(){if(this.#g>0){this.#m;const t=async()=>{this.#m?await this.#m(this.#h):await this.#p(this.#h),setTimeout(t,this.#g)};setTimeout(t,this.#g)}}}const l={OAuthInterceptor:function(t){const e=t;return e.fetchToken=async()=>{const t=await fetch(e.login.url,{method:e.login.method||"get"});return t=await t.json(),t[e.login.response.valueSelector]},c(t)},TokenInterceptor:c};t.defaultjs=t.defaultjs||{},t.defaultjs.httpinterceptor=t.defaultjs.httpinterceptor||{VERSION:"${version}",Manager:r,Interceptor:s,interceptors:l};const u="/templates",h="global:action:reload-parent",d="/api/system/login",p=(new URL(location),{ROLEMAPPING:{"ex-member":"EX Member",reservist:"Reservist",recruit:"Anwärter",private:"Member",junior_officer:"Member",combat_officer:"Feldkommandent",personnel_officer:"Personal Offizier",recruitment_officer:"Anwerber",executive_officer:"Ausführender Offizier",commander:"Clan Leader"}});window.APPGLOBALS=p;const f=window.localStorage,g="cached-login";let m,y,w,v=!1,b={};const x=(t=0)=>t-(Date.now()+864e5)<0,E=async()=>{let t=await fetch(new URL("/api/system/access",location));if(401==t.status)return!1;if(403==t.status)return null;var e,n;t=await t.json(),e=g,n=t,f.setItem(e,JSON.stringify({data:n}));const{member:a,accessToken:i,expireAt:r,accessRights:s}=t;return!x(r)&&(m=a,y=i,w=r,b=s,APPGLOBALS.member=m,APPGLOBALS.accessRights=b,N(),!0)},A=async()=>{const t=(t=>{const{data:e=null}=JSON.parse(f.getItem(t)||"{}");return e})(g);if(!t)return!1;const{member:e,accessToken:n,expireAt:a}=t;if(x(a))return i=g,f.removeItem(i),!1;var i;const r=new URL(d,location),s=r.searchParams;s.set("status","ok"),s.set("access_token",n),s.set("account_id",e.id),s.set("expires_at",a-Date.now()),await fetch(r)},N=()=>{const t=w-(Date.now()+6e4);setTimeout((async()=>{await E()}),t)},T=async()=>{if(!v){if(await A(),!await E())return location.href=new URL(d,location).toString(),!1;v=!0}return m},D=()=>b;r.addInterceptor(new class extends s{constructor(){super()}async doAccept(t){return location.origin==t.metadata.origin}async doHandle(t){const e=y;return e&&(t.request.headers=t.request.headers||{},t.request.headers.Authorization=`Bearer ${e}`),t}});const M=function(){const t=Array.from(arguments),e=t.shift();for(;t.length>0;){t.shift()(e)}},L={global:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},globalVar:function(t,e){return 2===arguments.length&&void 0===L.global[t]&&(L.global[t]=e),L.global[t]}},P=L,$=P.globalVar("___DOM_API_EXTENSION_MAP___",{}),C=function(t,e){return function(n){let a=$[n.name];a||(a=$[n.name]={}),a[t]?console.warn('duplicated load of extension "'+t+'"!'):(a[t]=!0,e(n.prototype))}},O=C("EventSupport",(t=>{const e=/(\s+)|(\s*,\s*)/,n=t=>(t.__wrapperhandlemap__||(t.__wrapperhandlemap__=new Map),t.__wrapperhandlemap__),a=(t,a,i)=>{const{wrapper:r,option:s,events:o,handle:c}=a,l=s.capture;if(i){i="string"==typeof i?i.split(e):i;for(let e of i){const a=o.indexOf(e);a>=0&&(t.removeEventListener(e,r,l),o.splice(a,1)),0==o.length&&n(t).delete(c)}}else{for(let e of o)t.removeEventListener(e,r,l);n(t).delete(c)}};t.on=function(){if(arguments.length<2)throw new Error("Too less arguments!");const t=Array.from(arguments);let i="string"==typeof t[0]?t.shift().split(e):t.shift();const r="string"==typeof t[0]?t.shift():null,s=t.shift(),o=void 0===t[0]?{capture:!1,once:!1,passive:!1}:"boolean"==typeof t[0]?{capture:t.shift(),once:!1,passive:!1}:t.shift(),c=function(t){if(r){const e=t.target;if("function"==typeof e.is&&!e.is(r))return}const e=s.apply(null,arguments);return o.once&&a(this,c),e};n(this).set(s,{handle:s,wrapper:c,events:i,option:o});for(let t of i)this.addEventListener(t,c,o);return this},t.removeOn=function(t,e,i){const r=n(this).get(t);return r?a(this,r,e):this.removeEventListener(t,e,i),this},t.trigger=function(){const t=Array.from(arguments),e="number"==typeof t[0]?t.shift():-1;if(e>=0){const a=t[0],i=((n=this).___EVENTTRIGGERTIMEOUTS___||(n.___EVENTTRIGGERTIMEOUTS___={}),n.___EVENTTRIGGERTIMEOUTS___),r=i[a];r&&clearTimeout(r),i[a]=setTimeout((()=>{delete i[a],this.trigger.apply(this,t)}),e)}else{const e=t.shift(),n=t[0]instanceof Event?t.shift():null,a=t.length>=1?1==t.length?t.shift():t:n,i=a?new CustomEvent(e,{bubbles:!0,cancelable:!0,composed:!0,detail:a}):new Event(e,{bubbles:!0,cancelable:!0,composed:!0});n&&(i.delegatedEvent=n),this.dispatchEvent(i)}var n;return this}}));M(EventTarget,O);const k=C("DataSupport",(t=>{t.data=function(){const t={};if(void 0!==this.dataset)for(name in this.dataset)t[name]=this.dataset[name];return this.data=function(){return 0==arguments.length?t:1==arguments.length?t[arguments[0]]:(void 0===arguments[1]||null==arguments[1]?delete t[arguments[0]]:t[arguments[0]]=arguments[1],this)}.bind(this),this.data.apply(null,arguments)}})),S=C("ManipulationSupport",(t=>{t.empty=function(){let t=this.childNodes;for(;0!=t.length;)t[0].remove(!0);return this},t.content=function(){return this.childNodes},t.html=function(){return 0==arguments.length?this.innerHTML:1==arguments.length&&"boolean"==typeof arguments[0]?arguments[0]?this.outerHTML:this.innerHTML:(Array.from(arguments).forEach((t=>{this.empty(),("string"==typeof t||t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection)&&this.append(t)})),this)};const e=function(){const e=t.appendChild.bind(this);for(let t=0;t<arguments.length;t++){let n=arguments[t];n instanceof Node?this.appendChild(n):"string"==typeof n?create(n).forEach(e):"function"==typeof n.forEach&&n.forEach(e)}};t.append=e;const n=function(t,e){this.insertBefore(e,t)};t.prepend=function(){if(0==this.childNodes.length)e.apply(this,arguments);else{const t=this.childNodes.first(),e=n.bind(this,t);for(let t=0;t<arguments.length;t++){const n=arguments[t];n instanceof Node?e(n):("string"==typeof n||"function"==typeof n.forEach)&&n.forEach(e)}}},t.replace=function(){if(arguments.length<1)throw new Error("Insufficient arguments! One or two nodes required!");const t=1==arguments.length?this.parentNode:this,e=1==arguments.length?this:arguments[0],n=1==arguments.length?arguments[0]:arguments[1];n instanceof Array||n instanceof NodeList||n instanceof HTMLCollection?(n.forEach((n=>t.insertBefore(n,e))),e.remove()):t.replaceChild(n,e)},t.after=function(){if(null==this.parentNode)throw new Error("Can't insert nodes after this node! Parent node not available!");const e=this.parentNode,n=this.nextSibling;n?t.before.apply(n,arguments):t.append.apply(e,arguments)},t.before=function(){if(null==this.parentNode)throw new Error("Can't insert nodes after this node! Parent node not available!");const t=this.parentNode,e=e=>{t.insertBefore(e,this)};for(let t=0;t<arguments.length;t++){const n=arguments[t];n instanceof Node?e(n):("string"==typeof n||"function"==typeof n.forEach)&&n.forEach(e)}}})),R=S;M(Node,k,R);const V=/:parent(\(\"([^\)]*)\"\))?/i,I=function(t,e){let n=V.exec(e);if(!n)return t.querySelectorAll(e);{let a=t;if(n.index>0&&(a=t.querySelectorAll(e.substr(0,n.index)),0==a.length))return;if(a=a.parent(n[2]),a){let t=e.substr(n.index+n[0].length).trim();return t.length>0&&(a=a.find(t)),a}}},j=C("QuerySupport",(t=>{t.find=function(){let t=[],e=Array.from(arguments),n=e.shift();for(;n;){if("string"==typeof n){let e=I(this,n);e&&t.push(e)}n=e.shift()}return NodeList.from.apply(null,t)},t.is=function(){if(this instanceof Document||this instanceof DocumentFragment)return!1;if(1==arguments.length){if("string"==typeof arguments[0])return this.matches(arguments[0]);if("number"==typeof arguments[0].length){let t=arguments[0];for(let e=0;e<t.length;e++)if(this.matches(t[e]))return!0}}else if(arguments.length>1)return this.is(Array.from(arguments));return!1},t.parent=function(t,e){if(!this.parentNode)return null;e="boolean"==typeof t?t:e,t="string"==typeof t?t:null;let n=this.parentNode;if(n instanceof ShadowRoot&&e&&(n=n.host),t){try{for(;n&&!n.is(t);)n=n.parent(t,e)}catch(t){console.error("this:",this,"parent:",n,"error:",t)}return n}return n},t.parents=function(){let e=new Array,n=t.parent.apply(this,arguments);for(;n;)e.push(n),n=t.parent.apply(n,arguments);return NodeList.from(e)},t.selector=function(){if(!(this instanceof Document||this instanceof DocumentFragment)){if(this.id)return"#"+this.id;{let t=this.tagName.toLowerCase(),e=this.parent();if(e){let n=e.find(":scope>"+t);if(n instanceof NodeList){let e=n.indexOf(this);e>0&&(t+=":nth-child("+(e+1)+")")}let a=e.selector();return a?a+">"+t:t}return t}}},t.closest=function(t){return this.closests(t).first()},t.closests=function(t){const e=this.find(t);if(0!=e.length)return e;const n=this.parentElement;return n?n.closests(t):NodeList.from([])},t.nested=function(t){if(this.is(t))return NodeList.from(this);let e=this.find(t);return e&&e.length>0?e:NodeList.from(this.parent(t))}})),H=j,z=C("AttributeSupport",(t=>{t.attr=function(){return 0==arguments.length?this.hasAttributes()?(()=>{const t={};return this.getAttributeNames().forEach((e=>{t[e]=this.getAttribute(e)})),t})():void 0:1==arguments.length?this.getAttribute(arguments[0]):(void 0===arguments[1]||null==arguments[1]?this.removeAttribute(arguments[0]):this.setAttribute(arguments[0],arguments[1]),this)}}));M(Element,H,z,R);const _=C("ReadyEventSupport",(t=>{t.ready=function(t,e){return this.on("ready",t,e),"complete"==document.readyState&&this.trigger("ready"),this}}));M(Document,H,_),document.addEventListener("DOMContentLoaded",(()=>document.trigger("ready"))),M(DocumentFragment,H,R);const U=C("HtmlClassSupport",(t=>{t.addClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.add(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.add(t))),this},t.removeClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.remove(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.remove(t))),this},t.toggleClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.toggle(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.toggle(t))),this}})),q="none",F=t=>t.style.display===q,G=t=>{let e=F(t)?"":t.style.display;return t.show=function(){return this.style.display=e,this}.bind(t),t.hide=function(){return this.style.display=q,this}.bind(t),t},K=C("ShowHideSupport",(t=>{t.show=function(){return G(this).show.apply(null,arguments)},t.hide=function(){return G(this).hide.apply(null,arguments)},t.toggleShow=function(){return F(this)?this.show():this.hide()}}));M(HTMLElement,U,K);const X=[{selector:"select",get:function(){const t=[];return this.find("option").forEach((e=>{e.selected&&t.push(e.value)})),t},set:function(){let t=[];const e=Array.from(arguments);let n=e.shift();for(;n;)Array.isArray(n)?t=t.concat(n):t.push(n),n=e.shift();this.value=t,this.find("option").forEach((e=>e.selected=t.indexOf(e.value)>=0)),this.trigger("changed")}},{selector:'input[type="checkbox"], input[type="radio"]',get:function(){return"on"==this.value||"off"==this.value?this.checked:this.checked?this.value:void 0},set:function(t){"boolean"==typeof t?this.checked=t:"string"==typeof t?this.checked=this.value==t:Array.isArray(t)&&(this.checked=t.indexOf(this.value)>=0),this.trigger("changed")}}],B={get:function(){return this.value},set:function(t){this.value=t,this.trigger("input")}},J=C("ValueSupport",(t=>{t.val=function(){let t=function(t){for(let e=0;e<X.length;e++)if(t.is(X[e].selector))return X[e];return B}(this);return 0==arguments.length?t.get.apply(this,arguments):(t.set.apply(this,arguments),this)}}));M(HTMLInputElement,J),M(HTMLTextAreaElement,C("ValueSupport",(t=>{t.val=function(){return 0==arguments.length?this.value:(this.value=arguments[0],this)}}))),M(HTMLSelectElement,J);const W=function(){const t=Array.from(arguments),e=t.shift(),n=t.shift();t.forEach((t=>{Object.getOwnPropertyNames(t).forEach((a=>{const i=Object.getOwnPropertyDescriptor(t,a);void 0===n[a]&&"function"==typeof i.value&&(n[a]=function(){return e.call(this,a,arguments)})}))}))},Z=C("ListSupport",(t=>{t.indexOf=function(){for(let t=0;t<this.length;t++)if(this[t]==arguments[0])return t;return-1},t.forEach=function(){return Array.prototype.forEach.apply(Array.from(this),arguments)},t.map=function(){return Array.prototype.map.apply(Array.from(this),arguments)},t.filter=function(){return Array.prototype.filter.apply(Array.from(this),arguments)},t.first=function(){if(this.length>0)return this[0]},t.last=function(){if(this.length>0)return this[this.length-1]}}));M(NodeList,Z),NodeList.prototype.applyTo=function(){const t=Array.from(arguments),e=t.shift(),n="function"==typeof e,a=[];for(let i=0;i<this.length;i++){const r=this[i];let s;n?s=e.apply([r].concat(t)):"function"==typeof r[e]&&(s=r[e].apply(r,t)),s&&a.push(s)}return a},NodeList.prototype.val=function(){if(0==arguments.length){if(this.length>0){const t=new Map;return this.forEach((e=>{if("function"==typeof e.val){e.val()&&t.set(e.name||e.id||e.selector(),e.val())}})),t}}else NodeList.prototype.applyTo.apply(this,["val"].concat(Array.from(arguments)))},NodeList.from=function(){const t=Array.from(arguments),e={};let n=0;for(;t.length>0;){const a=t.shift();if(void 0!==a&&null!=a)if(a instanceof Node)e[n++]={value:a,enumerable:!0};else if(a instanceof NodeList||a instanceof HTMLCollection||a instanceof Array)for(let t=0;t<a.length;t++)a[t]&&a[t]instanceof Node&&(e[n++]={value:a[t],enumerable:!0})}return e.length={value:n},Object.create(NodeList.prototype,e)},W((function(t,e){let n=[];return this.forEach((a=>{if(a&&"function"==typeof a[t]){const i=a[t].apply(a,e);i&&(i instanceof NodeList?n=n.concat(Array.from(i)):n.push(i))}})),0===n.length?void 0:n[0]instanceof Node||n[0]instanceof NodeList?NodeList.from(n):n}),NodeList.prototype,Node.prototype,HTMLElement.prototype,HTMLInputElement.prototype,Element.prototype,EventTarget.prototype),M(HTMLCollection,Z),HTMLCollection.prototype.applyTo=function(){const t=Array.from(arguments),e=t.shift(),n="function"==typeof e,a=[];for(let i=0;i<this.length;i++){const r=this[i];let s;n?s=e.apply([r].concat(t)):"function"==typeof r[e]&&(s=r[e].apply(r,t)),s&&a.push(s)}return a},HTMLCollection.prototype.val=function(){if(0==arguments.length){if(this.length>0){const t=new Map;return this.forEach((e=>{if("function"==typeof e.val){e.val()&&t.set(e.name||e.id||e.selector(),e.val())}})),t}}else HTMLCollection.prototype.applyTo.apply(this,["val"].concat(Array.from(arguments)))},HTMLCollection.from=function(){const t=Array.from(arguments),e={};let n=0;for(;t.length>0;){const a=t.shift();if(void 0!==a&&null!=a)if(a instanceof HTMLElement)e[n++]={value:a,enumerable:!0};else if(a instanceof HTMLCollection||a instanceof NodeList||a instanceof Array)for(let t=0;t<a.length;t++)a[t]&&a[t]instanceof HTMLElement&&(e[n++]={value:a[t],enumerable:!0})}return e.length={value:n},Object.create(HTMLCollection.prototype,e)},W((function(t,e){let n=[];return this.forEach((a=>{if(a&&"function"==typeof a[t]){let i=a[t].apply(a,e);i&&(i instanceof HTMLCollection?n=n.concat(Array.from(i)):n.push(i))}})),0===n.length?void 0:n[0]instanceof HTMLElement||n[0]instanceof HTMLCollection?HTMLCollection.from.apply(null,n):n}),HTMLCollection.prototype,Node.prototype,HTMLElement.prototype,HTMLInputElement.prototype,Element.prototype,EventTarget.prototype),P.global.defaultjs=P.global.defaultjs||{},P.global.defaultjs.extdom=P.global.defaultjs.extdom||{VERSION:"${version}",utils:{Utils:P}},P.global.find=function(){return document.find.apply(document,arguments)},P.global.ready=function(){return document.ready.apply(document,arguments)},P.global.create=function(t,e){if("string"!=typeof arguments[0])throw new Error("The first argument must be a string!");const n=document.createElement("template");return n.innerHTML=t,e?n:document.importNode(n.content,!0).childNodes},P.global.script=function(t,e){return t instanceof Array?Promise.all(t.map((t=>P.global.script(t,e)))):"string"==typeof t?new Promise(((n,a)=>{const i=document.createElement("script");i.async=!0,i.onload=function(){n()},i.onerror=function(){throw new Error("load error!")},e?e.append(i):document.body.append(i),i.src=t})):Promise.reject("First parameter must be an array of strings or a string!")};class Q{constructor(t,e){this.key=t,this.context=e}get keyDefined(){return this.key in this.context}get hasValue(){return!!this.context[this.key]}get value(){return this.context[this.key]}set value(t){this.context[this.key]=t}set append(t){if(this.hasValue){const e=this.value;e instanceof Array?e.push(t):this.value=[this.value,t]}else this.value=t}remove(){delete this.context[this.key]}static load(t,e,n=!0){let a=t;const i=e.split(".");let r=i.shift().trim();for(;i.length>0;){if(!a[r]){if(!n)return null;a[r]={}}a=a[r],r=i.shift().trim()}return new Q(r,a)}}const Y=t=>null==t||void 0===t,tt=t=>{if(null==t)return!0;switch(typeof t){case"number":case"bigint":case"boolean":case"string":case"undefined":return!0}return!1},et=t=>!Y(t)&&("object"==typeof t&&(!t.constructor||"Object"===t.constructor.name)),nt=(t,e)=>{const n=Y(t),a=Y(e);if(n||a)return t===e;if(tt(t)||tt(e))return t===e;const i=typeof t;return i==typeof e&&("function"===i?t===e:((t,e)=>{const n=Object.keys(t),a=Object.keys(e);if(n.length!==a.length)return!1;for(const a of n){const n=t[a],i=e[a];if(!nt(n,i))return!1}return!0})(t,e)&&((t,e)=>{const n=Object.getPrototypeOf(t),a=Object.getPrototypeOf(e);if(n!=a)return!1;if(!n)return!0;const i=Object.getOwnPropertyNames(n),r=Object.getOwnPropertyNames(a);if(i.length!==r.length)return!1;for(const n of i){const a=t[n],i=e[n];if(!nt(a,i))return!1}return!0})(t,e))},at=t=>{if(!et(t))return!1;for(const e in t){if("function"==typeof t[e])return!1}return!0},it=function(t,...e){t||(t={});for(let n of e)at(n)&&Object.getOwnPropertyNames(n).forEach((e=>{at(t[e])?it(t[e],n[e]):t[e]=n[e]}));return t},rt=function(){const[t,e,{deep:n=!1,recursive:a=!0,parents:i=[]}={}]=arguments,r={};for(let s in t){const o=t[s],c=e(s,o,t);if(!c||n&&null!=o){if(c&&n){"object"!==typeof o||o instanceof Array||o instanceof Map||o instanceof Set||o instanceof RegExp||i.includes[o]||o==t?r[s]=o:r[s]=rt(o,e,{deep:n,recursive:a,parents:i.concat(t)})}}else r[s]=o}return r},st=(t,e,n)=>{Object.defineProperty(t,e,{value:n,writable:!1,configurable:!1,enumerable:!1})},ot=(t,e,n)=>{Object.defineProperty(t,e,{get:n,configurable:!1,enumerable:!1})},ct={isNullOrUndefined:Y,isObject:et,equalPojo:nt,isPojo:at,append:function(t,e,n){if(void 0!==e){Q.load(n,t,!0).append=e}return n},merge:it,filter:rt,buildPropertyFilter:function({names:t,allowed:e}){return(n,a,i)=>t.includes(n)===e},defValue:st,defGet:ot,defGetSet:(t,e,n,a)=>{Object.defineProperty(t,e,{get:n,set:a,configurable:!1,enumerable:!1})}},lt=()=>{let t=null,e=null;const n=new Promise(((n,a)=>{t=n,e=a}));let a,i=!1,r=!1;return st(n,"resolve",(n=>{a=n,i=!0,a instanceof Error?(r=!0,e(a)):t(a)})),ot(n,"value",(()=>a)),ot(n,"error",(()=>r)),ot(n,"resolved",(()=>i)),n},ut=(t,e)=>{let n="unsupported";if("string"==typeof e)n=e;else if(e instanceof HTMLElement)n=e.nodeName;else{if("string"!=typeof e.NODENAME)throw new Error(typeof e+' is not supported as parameter "node"!');n=e.NODENAME}return`${n.toLowerCase()}:${t}`},ht=(t,e)=>ut(`attribute--${t}`,e),dt=new WeakMap,pt=t=>class extends t{#v=lt();constructor({shadowRoot:t=!1,content:e=null,createUID:n=!1,uidPrefix:a="id-",uidSuffix:i=""}={}){super(),n&&this.attr("id",n(a,i)),t&&this.attachShadow({mode:"open"}),e&&this.root.append("function"==typeof e?e(this):e)}get root(){return this.shadowRoot||this}get ready(){return this.#v}async init(){}async destroy(){this.ready.resolved&&(this.#v=lt())}connectedCallback(){this.ownerDocument==document&&this.isConnected&&(t=>{let e=dt.get(t);e&&clearTimeout(e),dt.get(t,setTimeout((async()=>{dt.delete(t);try{await t.init(),t.ready.resolve()}catch(e){console.error("Can't initialize component!",t,e),t.ready.resolve(e)}t.trigger(ut("initialzed",t))}),10))})(this)}adoptedCallback(){this.connectedCallback()}attributeChangedCallback(t,e,n){e!=n&&this.isConnected&&(this.trigger(10,ht(t,this)),this.trigger(10,ut("change",this)))}disconnectedCallback(){this.destroy()}},ft=new Map,gt=t=>{let e=ft.get(t);return null==e&&(e=pt(t),ft.set(t,e)),e},mt=gt(HTMLElement),yt=(t,e)=>"string"==typeof e?e+t:"d-"+t,wt=function(t,e){const n=t.NODENAME;customElements.get(n)||customElements.define(n,t,e)},vt=(t,e,n)=>{if(n(t))return{node:t,depth:e};let a=null;for(let i of t.childNodes){const t=vt(i,e+1,n);null!=t&&(null==a||a.depth>t.depth)&&(a=t)}return a},bt=(t,e)=>{const n=vt(t,0,e);return null!=n?n.node:null},xt=new WeakMap,Et=t=>{if(xt.has(t))return xt.get(t);const e={};return xt.set(t,e),e},At=function(t,e,n){const a=Et(t);if(1===arguments.length)return a;if(2===arguments.length)return a[e];if(3!==arguments.length)throw new Error("Not allowed size of arguments!");a[e]=n},Nt=t=>function(e,n){if(2!=arguments.length)return At(e,t);At(e,t,n)},Tt=yt("route"),Dt=`${Tt}-init`,Mt=`${Tt}-click`,Lt=`${Tt}-activate`,Pt=`${Tt}-deactivate`,$t=yt("route-link"),Ct=$t+"-to-route",Ot=void 0!==n.g?n.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{};class kt{constructor(t){this.hasValue=1==arguments.length,this.value=t}}class St{constructor(t,e){this.data=t,this.resolver=e,this.cache=new Map}updateData(t){this.data=t,this.cache=new Map}resetCache(){this.cache=new Map}getPropertyDef(t,e=!0){if(this.cache.has(t))return this.cache.get(t);let n=null;if(this.data&&t in this.data)n={data:this.data,resolver:this.resolver,defined:!0};else{if(!e)return null;n=((t,e)=>{for(;t;){const n=t.proxy.handle.getPropertyDef(e,!1);if(n)return n;t=t.parent}return{data:null,resolver:null,defined:!1}})(this.resolver.parent,t)}return n.defined&&this.cache.set(t,n),n}hasProperty(t){const{defined:e}=this.getPropertyDef(t);return e}getProperty(t){const{data:e}=this.getPropertyDef(t);return e?e[t]:void 0}setProperty(t,e){const{data:n,defined:a}=this.getPropertyDef(t);a?n[t]=e:(this.data||(this.data={}),this.data[t]=e,this.cache.set(t,{data:this.data,resolver:this.resolver,defined:!0}))}deleteProperty(t){throw new Error("unsupported function!")}}class Rt{constructor(t,e){this.handle=new St(t,e),this.data=new Proxy(this.handle,{has:function(t,e){return t.hasProperty(e)},get:function(t,e){return t.getProperty(e)},set:function(t,e,n){return t.setProperty(e,n)},deleteProperty:function(t,e){return t.deleteProperty(e)}})}updateData(t){this.handle.updateData(t)}resetCache(){this.handle.resetCache()}}const Vt=/(\\?)(\$\{(([a-zA-Z0-9\-_\s]+)::)?([^\{\}]+)\})/,It=new kt,jt=t=>t instanceof kt?t:new kt(t),Ht=async function(t,e,n,a){if(n&&t.name!=n)return t.parent?Ht(t.parent,e,n,a):null;const i=await async function(t,e){if("string"!=typeof t)return t;const n=new Function("context",`\nreturn (async (context) => {\n\ttry{ \n\t\twith(context){\n\t\t\t return ${t}\n\t\t}\n\t}catch(e){\n\t\tthrow e;\n\t}\n})(context)`);let a,i=setTimeout((()=>{i=null,console.warn("long running statement:",t,new Error)}),1e3);try{a=await n(e)}catch(t){}return i&&clearTimeout(i),a}(e,t.proxy.data);return null!=i?i:a instanceof kt&&a.hasValue?a.value:void 0},zt=async(t,e,n)=>e[1]?e[2]:Ht(t,e[5],_t(e[4]),n),_t=t=>t?0==(t=t.trim()).length?null:t:null;class Ut{constructor({context:t=Ot,parent:e=null,name:n=null}){this.parent=e instanceof Ut?e:null,this.name=n,this.context=t,this.proxy=new Rt(this.context,this)}get chain(){return this.parent?this.parent.chain+"/"+this.name:"/"+this.name}get effectiveChain(){return this.context?this.parent?this.parent.effectiveChain+"/"+this.name:"/"+this.name:this.parent?this.parent.effectiveChain:""}get contextChain(){const t=[];let e=this;for(;e;)e.context&&t.push(e.context),e=e.parent;return t}getData(t,e){if(t){if(!e||e==this.name){const e=Q.load(this.context,t,!1);return e?e.value:null}this.parent&&this.parent.getData(t,e)}}updateData(t,e,n){if(t)if(n&&n!=this.name)this.parent&&this.parent.updateData(t,e,n);else{null!=this.context&&void 0!==this.context||(this.context={},this.proxy.updateData(this.context));Q.load(this.context,t).value=e,this.proxy.resetCache()}}mergeContext(t,e){e&&e!=this.name?this.parent&&this.parent.mergeContext(t,e):this.context=this.context?ct.merge(this.context,t):t}async resolve(t,e){const n=2==arguments.length?jt(e):It;try{const e=Vt.exec(t);return e?await zt(this,e,n):await Ht(this,_t(t),null,n)}catch(e){return console.error('error at executing statment"',t,'":',e),n.hasValue?n.value:t}}async resolveText(t,e){let n=t,a=t,i=Vt.exec(n);const r=2==arguments.length?jt(e):It;for(;null!=i;){const t=await zt(this,i,r);a=a.split(i[0]).join(),n=n.split(i[0]).join(void 0===t?"undefined":null==t?"null":t),i=Vt.exec(a)}return n}static async resolve(t,e,n,a){const i=new Ut({context:e}),r=arguments.length>2?jt(n):It;return"number"==typeof a&&a>0?new Promise((e=>{setTimeout((()=>{e(i.resolve(t,r))}),a)})):i.resolve(t,r)}static async resolveText(t,e,n,a){const i=new Ut({context:e}),r=arguments.length>2?jt(n):It;return"number"==typeof a&&a>0?new Promise((e=>{setTimeout((()=>{e(i.resolveText(t,r))}),a)})):i.resolveText(t,r)}static buildSecure({context:t,propFilter:e,option:n={deep:!0},name:a,parent:i}){return t=ct.filter({data:t,propFilter:e,option:n}),new Ut({context:t,name:a,parent:i})}}n(609);const qt="template",Ft={},Gt=async(t,e,n)=>Kt(create(t,!0),e,n),Kt=async(t,e,n)=>{let a=null;if(t instanceof HTMLTemplateElement)a=new Xt(t,n);else{if(a=document.createElement("template"),!(t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array))throw new Error("Template type is not supported!");a.content.append(t.cloneNode(!0)),a=new Xt(a,n)}if(!a)throw new Error("Template can't loaded!");return e&&n&&(Ft[n]=a),a};class Xt{constructor(t,e){this.template=t,this.key=e}importContent(t=document){return t.importNode(this.template,!0).content.childNodes}remove(){this.key&&Ft[this.key]&&delete Ft[this.key]}static async fetch(t,e=!0,n=null){return"string"==typeof t?Xt.load(new URL(t,loaction),e,n):t instanceof URL?Xt.load(t,e,n):void new Error("The url isn't a allowed type! -> [String|URL] required!")}static async load(t,e=!0,n=null){if(t instanceof Xt)return t;const a=((t,e,n)=>{if(!e)return null;let a=null;return n?a=n:"string"==typeof t?a=t:t instanceof URL?a=t.toString():t instanceof HTMLElement&&(a=t.selector()),a?a.hashcode():null})(t,e,n);return a&&Ft[a]?Ft[a]:"string"==typeof t?Gt(t,e,a):t instanceof URL?await(async(t,e,n)=>{const a=await fetch(t.toString()),i=await a.text();return Gt(i,e,n)})(t,e,a):t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection||t instanceof HTMLTemplateElement?Kt(t,e,a):void new Error("The template isn't a allowed type! -> [String|URL|Node|NodeList|HTMLCollection|Template] required!")}static async loadNodeTemplate(t,e,n,a){try{const e=(t=>{let e=t.find(":scope > template").first();if(e)return e;const n=t.attr(qt);if(!n)return null;try{if(e=find(n).first(),e)return e}catch(t){}return new URL(n,location)})(t);if(e)return Xt.load(e,n,a)}catch(e){console.warn("Can't load template from node!",t,e)}return e}}const Bt="name",Jt="active",Wt="stateful",Zt="component-tag",Qt="component-tag-attributes",Yt="view",te=[Bt,qt,Zt,Qt,Wt,Yt],ee=[Mt,Lt,Pt],ne=Nt(qt),ae=async t=>{if(t.hasAttribute(qt)){let e=ne(t);return e||(e=await Xt.loadNodeTemplate(t,null,!1),ne(t,e)),e}{const e=t.attr(Zt),n=customElements.get(e),a=await(async t=>{const e=t.attr(Qt)||"{}";return Ut.resolve(e,{},{})})(t),i=new n;for(let t in a){const e=a[t];"string"==typeof e&&i.attr(t,e)}return i}};class ie extends mt{static get observedAttributes(){return te}static get NODENAME(){return Tt}static get EVENTS(){return ee}#b=!1;constructor(t){super(t||{}),this.on("click",(()=>{this.active||this.trigger(Mt)}))}async init(){await super.init(),this.#b||(this.#b=!0,this.trigger(Dt),this.active&&this.trigger(Mt))}get name(){return this.attr(Bt)}get view(){return this.attr(Yt)}get active(){return this.hasAttribute(Jt)}set active(t){t!=this.active&&(this.attr(Jt,t?"":null),t?this.trigger(Lt):this.trigger(Pt))}get stateful(){return this.hasAttribute(Wt)}get context(){return this.attr("context")}get refresh(){return this.hasAttribute(ATTR_REFRESH)}async component(){return ae(this)}}wt(ie);const re=ie,se="target",oe="context",ce=[se,oe],le=[Ct];class ue extends mt{static get observedAttributes(){return ce}static get NODENAME(){return $t}static get EVENTS(){return le}constructor(t){super(t||{}),this.on("click",(t=>{t.preventDefault(),this.trigger(Ct)}))}async init(){}get view(){return this.attr("view")}get target(){return this.attr(se)}get context(){return this.attr(oe)}get refresh(){return this.hasAttribute("refresh")}}wt(ue);const he=ue,de=yt("view"),pe=[],fe={init:0,data:1,template:2,content:3,finish:4};class ge{static get PHASE(){return fe}static get MIN_RANK(){return 0}static get MAX_RANK(){return 1e5}constructor(){}get name(){}get rank(){}get phase(){return fe.finish}async execute(t){return t}static define(t){(({directive:t})=>{if(!(t instanceof ge))throw new Error("Implementation dosn't extend Directive class!");if(t.rank<ge.MIN_RANK)throw new Error("The rank of a directive can't be lower as "+ge.MIN_RANK+"!");if(t.rank>ge.MAX_RANK)throw new Error("The rank of a directive can't be grater as "+ge.MAX_RANK+"!");pe.push(t),pe.sort(((t,e)=>{const n=t.phase-e.phase;return 0==n?t.rank-e.rank:n}))})(t)}static get directives(){return pe}}new Set,new Map;const me=t=>t instanceof Xt?t.importContent():typeof t===String?create(t):t;let ye=0;class we{#x;#E;#A;#N;#T;#D;#M;#L;#P;#$;#C;constructor({content:t=null,resolver:e,renderer:n,template:a,container:i,root:r,mode:s="replace",target:o=null,parent:c=null,wait:l=null,callbacks:u=null,ignoreDirective:h}){if(!e)throw new Error('Parameter "resolver" is required!');if(!n)throw new Error('Parameter "renderer" is required!');if(!a)throw new Error('Parameter "template" is required!');if(!i)throw new Error('Parameter "container" is required!');if(!r)throw new Error('Parameter "root" is required!');this.#x=c?`${c.id}->${ye++}`:"root::"+ye++,this.#E=c?c.depth+1:0,this.#A=c,this.#N=n,this.#T=r,this.#D=me(a),this.#M=s,this.#L=new Set,this.#P=l||lt(),this.#$=h instanceof Set?h:new Set,this.#C=u instanceof Array?u:[],this.content=t,this.container=i,this.target=o,this.resolver=e,this.stop=!1,this.ignore=!1,c&&c.subcontexts.add(this)}get id(){return this.#x}get depth(){return this.#E}get parent(){return this.#A}get renderer(){return this.#N}get root(){return this.#T}get template(){return this.#D}set template(t){this.#D=me(t)}get mode(){return this.#M}get subcontexts(){return this.#L}get closed(){return this.#P.resolved}ignoreDirective(t){const e=this.#$;t instanceof ge?e.add(t.name):e.add(t)}acceptDirective(t){const e=this.#$;return t instanceof ge?!(e.has(t.name)||e.has(t)):!e.has(t)}finished(t){this.parent?this.parent.finished(t):this.ready(t)}async ready(t){const e=this.#C;if(!t){const t=this.#P;if(!t.resolved){if(!this.ignore)for(let t of e)await t(this);for(let t of this.subcontexts)await t.ready();this.parent&&this.parent.subcontexts.delete(this),t.resolve(this)}return t}t instanceof Array?t.forEach((t=>this.wait.then(t))):t instanceof Promise?e.push((async()=>await t)):"function"==typeof t&&e.push(t)}subContext({resolver:t=this.resolver,renderer:e=this.renderer,template:n=this.template,container:a=this.container,root:i=this.root,mode:r=this.mode,target:s=this.target,ignoreDirective:o=null}={}){return new we({resolver:t,renderer:e,template:n,container:a,mode:r,root:i,target:s,parent:this,ignoreDirective:o})}clone({content:t=this.content,template:e=this.template,container:n=this.container,root:a=this.root,mode:i=this.mode,target:r=this.target,ignoreDirective:s=this.#$}={}){return new we({content:t,resolver:this.resolver,renderer:this.renderer,template:e,container:n,root:a,mode:i,target:r,ignoreDirective:s,wait:this.#P,callbacks:this.#C})}toRenderOption({resolver:t=this.resolver,renderer:e=this.renderer,template:n=this.template,container:a=this.container,root:i=this.root,mode:r=this.mode,target:s=this.target,ignoreDirective:o=null}={}){return{resolver:t,renderer:e,template:n,container:a,mode:r,root:i,target:s,parent:null,ignoreDirective:o}}}class ve extends HTMLElement{constructor(){super(),this.hidden=!0}async execute({template:t,context:e}){return e.content=t.cloneNode(!0),e}}class be extends ve{constructor(){super(),this.attachShadow({mode:"open"})}async execute({template:t,context:e}){return e}}try{customElements.define("jstl-replace",be)}catch(t){}ge.define({directive:new class extends ge{constructor(){super()}get name(){return"initial"}get rank(){return ge.MIN_RANK}get phase(){return ge.PHASE.init}async execute(t){const{template:e,renderer:n,resolver:a}=t;if(e instanceof Element)if(e.attr("jstl-ignore"))t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0;else if(e.attr("jstl-async")){t.content=new be,e.attr("jstl-async",null);const a=t.toRenderOption({mode:"replace",target:t.content});setTimeout((()=>{n.render(a)}),parseInt(e.attr("jstl-async")||"250")||250),t.stop=!0,t.ignore=!0}else if(e instanceof HTMLTemplateElement){t.content=document.createElement(e.tagName);const a=t.subContext({template:e.content.childNodes,container:t.content.content});await n.render(a),t.stop=!0,t.ignore=!0}else if(e.hasAttribute("jstl-tagname")){e.attr("jstl-tagname").trim().length>0?t.content=document.createElement(await a.resolveText(e.attr("jstl-tagname"))):(t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0)}else if(e.tagName){let n=e.attr("is");if(n){n=await a.resolveText(n);const i=document.createElement(e.tagName,{is:n});i.attr("is",n),t.content=i}else t.content=document.createElement(e.tagName)}else t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0;else t.content=document.importNode(e,!0);return t}}});const xe={remote:async({data:t,context:e})=>{const{resolver:n,template:a}=e;t=await n.resolveText(t),t=new URL(t,location.origin);let i=await n.resolveText(a.attr("jstl-data-option")||"{}");return i=JSON.parse(i),(t=await fetch(t.toString(),i)).json()},set:async({data:t,context:e})=>{const{resolver:n}=e;return t=await n.resolve(t)},direct:async({data:t,context:e})=>{const{resolver:n}=e;return t=await n.resolveText(t)}};ge.define({directive:new class extends ge{constructor(){super()}get name(){return"data"}get rank(){return 1e3}get phase(){return ge.PHASE.data}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.attr("jstl-data")))return t;try{const{template:e}=t,n=xe[e.attr("jstl-data-mode")||"remote"];if(!n)throw new Error("The jstl-data-mode is unsupported!");let a=e.attr("jstl-data");a=await n({data:a,context:t});const i=e.attr("jstl-data-var");t=(({varname:t,data:e,scope:n,context:a})=>{if(t)a.resolver.updateData(t,e,n);else if(n)a.resolver.mergeContext(e,n);else{const t=new Ut({context:e,name:"jstl-data",parent:a.resolver});a.resolver=t}return a})({varname:i,data:a,scope:e.attr("jstl-data-scope"),context:t})}catch(e){console.error(e,t.template)}return t}}});ge.define({directive:new class extends ge{constructor(){super()}get name(){return"if"}get rank(){return ge.MIN_RANK+1e3}get phase(){return ge.PHASE.init}async execute(t){const{template:e}=t;if(!(e instanceof HTMLElement&&e.attr("jstl-if")))return t;const n=e.attr("jstl-if"),a=t.resolver;return await a.resolve(n,!1)||(t.content=null,t.stop=!0,t.ignore=!0),t}}});ge.define({directive:new class extends ge{constructor(){super()}get name(){return"choose"}get rank(){return ge.MIN_RANK+1}get phase(){return ge.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.hasAttribute("jstl-choose")&&0!=t.template.children.length))return t;t.template=t.template.cloneNode(!0);const{template:e,resolver:n}=t;let a=!1;const i=e.find(":scope > [jstl-when]"),r=i.length;for(let t=0;t<r;t++){const e=i[t];!a&&await n.resolve(e.attr("jstl-when"),!1)?a=!0:e.remove()}return a&&e.find(":scope > [jstl-otherwise]").remove(),t}}});ge.define({directive:new class extends ge{constructor(){super()}get name(){return"include"}get rank(){return ge.MIN_RANK}get phase(){return ge.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.attr("jstl-include")))return t;try{const{template:e,resolver:n,renderer:a}=t;let i=e.attr("jstl-include");i=await n.resolveText(i),i=new URL(i,location),i=await Xt.load(i);const r=e.attr("jstl-include-mode")||"replace",s=t.subContext({template:i,container:t.content,mode:r});return await a.render(s),await s.ready(),t.ignore=!0,t.stop=!0,t}catch(e){return console.error(e,t.template),t}}}});const Ee="jstl-foreach",Ae="jstl-foreach-var",Ne="jstl-foreach-status",Te="jstl-foreach-count",De="jstl-foreach-start",Me="jstl-foreach-step",Le="jstl-foreach-condition",Pe=async(t,e)=>{let{template:n,resolver:a,renderer:i,container:r,condition:s,context:o}=e;if(a=new Ut({context:t,name:"jstl-foreach",parent:a}),s=!!s&&await a.resolve(s,!1),s)return!1;const c=o.subContext({resolver:a,container:r,template:n,mode:"append"});return await i.render(c),await c.ready(),!0};ge.define({directive:new class extends ge{constructor(){super()}get name(){return"foreach"}get rank(){return ge.MIN_RANK+2}get phase(){return ge.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement)||!t.template.attr(Ee)&&!t.template.attr(Te))return t;t.ignore=!0;try{const{template:e,resolver:n,renderer:a,content:i}=t,r={data:(e.attr(Ee)||"").trim(),count:(e.attr(Te)||"").trim(),start:await n.resolve(e.attr(De)||"0"),step:await n.resolve(e.attr(Me)||"1"),varname:(e.attr(Ae)||"item").trim(),status:(e.attr(Ne)||"status").trim(),condition:e.attr(Le),template:e.childNodes,resolver:n,renderer:a,container:i,context:t};r.data&&""!=r.data||!r.count?await(async t=>{let{data:e,start:n,step:a,count:i,varname:r,status:s,resolver:o}=t;e=await o.resolve(e);let c=e;e instanceof Array||(c=Object.getOwnPropertyNames(e)),i=""!=i?await o.resolve(i,0):null;const l=i?Math.min(n+i,c.length):c.length;let u=!1;for(let i=n;i<l&&!u;i+=a){const n={};n[r]=e[i],n[s]={index:i,number:i+1,count:l,data:e},u=!await Pe(n,t)}})(r):await(async t=>{let{start:e,step:n,count:a,varname:i,status:r,resolver:s}=t;a=await s.resolve(a);const o=e+a*n;let c=!1;for(let s=e;s<o&&!c;s+=n){const e={};e[i]=s,e[r]={index:s,number:s+1,step:n,count:a},c=!await Pe(e,t)}})(r)}catch(t){console.error("error at jstl-foreach:",t)}return t}}});const $e="jstl-repeat",Ce=new Set([$e]),Oe={DATA:`${$e}`,VAR:`${$e}-var`,STATUS:`${$e}-status`,COUNT:`${$e}-count`,START:`${$e}-start`,STEP:`${$e}-step`,CONDITION:`${$e}-condition`},ke=async(t,e)=>{let{template:n,resolver:a,renderer:i,condition:r,context:s}=e;if(a=new Ut({context:t,name:$e,parent:a}),r=!!r&&await a.resolve(r,!1),r)return!1;const o=s.subContext({resolver:a,template:n,mode:"append",ignoreDirective:Ce});return await i.render(o),await o.ready(),!0};ge.define({directive:new class extends ge{constructor(){super()}get name(){return $e}get rank(){return ge.MIN_RANK+3}get phase(){return ge.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement)||!t.template.attr(Oe.DATA)&&!t.template.attr(Oe.COUNT))return t;try{const{template:e,resolver:n,renderer:a,content:i,container:r}=t,s={data:(e.attr(Oe.DATA)||"").trim(),count:(e.attr(Oe.COUNT)||"").trim(),start:await n.resolve(e.attr(Oe.START)||"0"),step:await n.resolve(e.attr(Oe.STEP)||"1"),varname:(e.attr(Oe.VAR)||"item").trim(),status:(e.attr(Oe.STATUS)||"status").trim(),condition:e.attr(Oe.CONDITION),template:e,tagname:i.tagName,resolver:n,renderer:a,container:r,context:t};s.data&&""!=s.data||!s.count?await(async t=>{let{data:e,start:n,step:a,count:i,varname:r,status:s,resolver:o}=t;e=await o.resolve(e);let c=e;e instanceof Array||(c=Object.getOwnPropertyNames(e)),i=""!=i?await o.resolve(i,0):null;const l=i?Math.min(n+i,c.length):c.length;let u=!1;for(let i=n;i<l&&!u;i+=a){const n={};n[r]=e[i],n[s]={index:i,number:i+1,count:l,data:e},u=!await ke(n,t)}})(s):await(async t=>{let{start:e,step:n,count:a,varname:i,status:r,resolver:s}=t;a=await s.resolve(a);const o=e+a*n;let c=!1;for(let s=e;s<o&&!c;s+=n){const e={};e[i]=s,e[r]={index:s,number:s+1,step:n,count:a},c=!await ke(e,t)}})(s)}catch(t){console.error("error at jstl-repeat:",t)}return t.content=null,t.stop=!0,t.ignore=!0,t}}});const Se={mode:"text",unsecure:!1,preventFormat:!1,maxLength:0},Re={text:async(t,e)=>{const{content:n,resolver:a,template:i}=e;let r=await a.resolveText(i.textContent);r=create(r,!0).content.textContent,t.maxLength>0&&(r=((t,e)=>t.length>e?t.substring(0,e-3).trim()+"...":t)(r,t.maxLength)),n.textContent=r},html:async(t,e)=>{const{resolver:n,template:a}=e;let i=await n.resolveText(a.textContent);i=create(i,!0),i=document.importNode(i.content,!0),t.unsecure||i.find("script, style, body, html, head, object, link").remove(),e.content=i}};ge.define({directive:new class extends ge{constructor(){super()}get name(){return"text"}get rank(){return ge.MIN_RANK+1}get phase(){return ge.PHASE.content}async execute(t){const{template:e}=t;if(!(e instanceof Text)||0==e.textContent.trim().length||e.parentElement&&e.parentElement.hasAttribute("jstl-text-ignore"))return t;const n=e.parentElement,a=n?await(async(t,e)=>{const n=e.resolver;return{mode:await n.resolveText((t.attr("jstl-text-content-type")||"text").trim().toLowerCase()),unsecure:t.hasAttribute("jstl-text-unsecure"),preventFormat:!!t.attr("jstl-text-prevent-format")||!1,maxLength:parseInt(await n.resolveText(t.attr("jstl-text-trim-length")||"0"))}})(n,t):Se,i=Re[a.mode];if(!i)throw new Error('Text mode "'+a.mode+'" is unsupported!');return await i(a,t),t}}});const Ve=/(jstl)?(\?)?(@)?([^\?@]+)/i,Ie="default",je="prevent-default",He=["is"],ze={delegate:async(t,e,n,a,i,r,s,o)=>{const c=await i.resolveText(e,e);r.on(t,Ge(c,n))},toggleclass:async(t,e,n,a,i,r,s,o)=>{const c=s.shift(),l=s.includes(je),u=e?await i.resolveText(e,e):null;r.on(t,(t=>{l&&t.preventDefault(),u?r.closests(u).toggleClass(c):r.toggleClass(c)}))},toggleattribute:async(t,e,n,a,i,r,s,o)=>{const c=s.shift(),l=s.includes(je),u=e?await i.resolveText(e,e):null;r.on(t,(t=>{l&&t.preventDefault(),u?r.closests(u).forEach((t=>{t.toggleAttribute(c)})):r.toggleAttribute(c)}))},[Ie]:async(t,e,n,a,i,r,s,o)=>{const c=e?await i.resolve(e,e):null;if(c){if("function"==typeof c)r.on(t,c);else if("string"==typeof c)r.on(t,Ge(c,n));else if("object"==typeof c){const{capture:e=!1,passive:n=!1,once:a=!1}=c;r.on(t,c.eventHandle,{capture:e,passive:n,once:a})}}else console.error(new Error("Can't resolve \""+e+'" to event handle!'))}},_e=async({condition:t,name:e,value:n,context:a})=>{const{resolver:i,content:r,template:s}=a;let o=t?s.attr(e):n;t=t?n:s.attr("?"+e);const c=Ue(o);t&&c?!0===(t=await i.resolve(t,!1))&&r.attr(e,await i.resolveText(o,o)):t?!0===(t=await i.resolve(t,!1))&&r.attr(e,!0):c&&r.attr(e,await i.resolveText(o,o))},Ue=t=>null!=t&&void 0!==t,qe=async({condition:t,name:e,value:n,context:a})=>{const{resolver:i,template:r,content:s}=a;let o=(t=t?n:r.attr("?@"+e))?r.attr("@"+e):n,c=e.split("::");1==c.length&&(c=e.split(":"));const l=c.shift(),u=(c.shift()||Ie).toLowerCase();void 0!==o&&null!=o||console.error(`Definition of "${l}" - event handle at`,s,"is incorrect!"),o=o.trim();const h={bubble:!0};t?1==await i.resolve(t,!1)&&await Fe(l,o,h,u,i,s,c,a):await Fe(l,o,h,u,i,s,c,a)},Fe=async(t,e,n,a,i,r,s,o)=>{const c=ze[a];if(c)return c(t,e,n,a,i,r,s,o)},Ge=function(t,e){return function(e){e.preventDefault(),e.stopPropagation(),e.currentTarget?e.currentTarget.trigger(t,e):e.target.trigger(t,e)}};ge.define({directive:new class extends ge{constructor(){super()}get name(){return"attribute"}get rank(){return ge.MIN_RANK}get phase(){return ge.PHASE.content}async execute(t){const{template:e}=t;if(!(e instanceof HTMLElement))return t;const n=new Set(He);for(const a of e.attributes){const[,e,i,r,s]=Ve.exec(a.name);if(!e&&!n.has(s)){const e=a.value;r?await qe({condition:i,event:r,name:s,value:e,context:t}):await _e({condition:i,name:s,value:e,context:t})}n.add(s)}return t}}});const Ke="jstl-attach-element",Xe="replace",Be=/^#.+$/;ge.define({directive:new class extends ge{constructor(){super()}get name(){return"attach-element"}get rank(){return ge.MIN_RANK+1}get phase(){return ge.PHASE.content}async execute(t){const{resolver:e,template:n,content:a}=t;if(!(n instanceof HTMLElement&&n.attr(Ke)))return t;try{let i=await(async(t,e)=>{let n=(t.attr(Ke)||"").trim();if(!Be.test(n)){try{n=await e.resolve(n,n)}catch(t){}if(n instanceof HTMLElement)return n}try{n=find(n)}catch(t){}return n&&n.length>0?0==n.length?n.first():n:null})(n,e);if(i){const e=n.attr("jstl-attach-element-mode")||Xe;e==Xe?(a.empty().append(i),t.stop=!0,t.ignore=!0):t.ready((({content:t})=>{t&&("append"==e?t.append(i):"prepend"==e&&t.prepend(i))}))}}catch(e){console.log(e,{context:t})}return t}}});const Je="on-finished",We=`jstl-${Je}`,Ze=`${We}-async`;ge.define({directive:new class extends ge{constructor(){super()}get name(){return Je}get rank(){return ge.MAX_RANK}get phase(){return ge.PHASE.finish}async execute(t){const{template:e,content:n,root:a}=t;if(!(e instanceof HTMLElement&&e.hasAttribute(We)))return t;const i=e.attr(We),r=e.hasAttribute(Ze),s=new Ut({context:{$element:n,$root:a,$template:e},name:"jstl-data",parent:t.resolver});return t.finished((async()=>{try{if(!r)return s.resolve(i,null);s.resolve(i,null)}catch(t){console.error(t)}})),t}}});const Qe="data",Ye="render",tn="container",en="node",nn=new Ut({name:"application"}),an={replace:async({container:t,target:e=null,content:n})=>{e?e.replace(n):(t.empty(),t.append(n))},append:async({container:t,target:e=null,content:n})=>{e?e.after(n):t.append(n)},prepend:async({container:t,target:e=null,content:n})=>{e?e.before(n):t.prepend(n)}},rn=async t=>{try{let{template:e,renderer:n}=t;e instanceof ve?await e.execute(t):await sn(t);const{ignore:a,content:i}=t;if(!a&&i){let{resolver:e}=t;const a=t.template.childNodes;if(a&&a.length>0){const r=new Ut({name:tn,context:null,parent:e}),s=await n.render(t.subContext({container:i,template:a,resolver:r}));await s.ready()}}t.content&&t.content.tagName&&"JSTL"==t.content.tagName&&(t.content=t.content.childNodes)}catch(e){console.error("error at render node:",e,t)}return t},sn=async t=>{const e=ge.directives,n=e.length;for(let a=0;a<n&&!t.stop;a++){const n=e[a];try{t.acceptDirective(n)&&await n.execute(t)}catch(e){console.error("error at directive:",e,n,t)}}return t};class on{constructor({template:t,data:e}={}){if(t&&!(t instanceof Xt))throw new Error("template must be an instance of Template!");this.template=t,this.resolver=new Ut({name:Qe,context:e||{},parent:nn})}async render(t){const e=t instanceof we;if(e){if(t.closed)throw new Error("calling with closed context",t)}else{let{template:e=null,data:n=null,container:a,root:i,mode:r,target:s}=t;e=await(async(t,e)=>{if(t)return(t=await Xt.load(t)).importContent();if(e.template)return await e.template.importContent();throw new Error("No content template specified!")})(e,this);const o=new Ut({name:Ye,context:n,parent:this.resolver});t=new we({resolver:o,renderer:this,template:e,container:a,root:i||a,mode:r||"replace",target:s})}return t.template instanceof Node?await rn(t):await(async t=>{let{template:e,resolver:n}=t;if(!e||0==e.length)return t;let a=[];for(let i of e){i.normalize();const e=new Ut({name:en,context:null,parent:n}),r=await rn(t.subContext({template:i,resolver:e}));await r.ready();const s=r.content;s&&(s instanceof Array&&(a=a.concat(s)),s instanceof NodeList||s instanceof HTMLCollection?a=a.concat(Array.from(s)):s instanceof Node&&a.push(s))}return t.content=0!=a.length?a:null,t})(t),await(async t=>{if(t.content){const e=an[t.mode];if(!e)throw new Error('The "'+t.mode+'" is not supported!');await e(t)}})(t),e||await t.ready(),t}static async build({template:t,data:e}={}){return t&&t instanceof Promise&&(t=await t),t=t?await Xt.load(t):null,new on({template:t,data:e})}static async render({container:t,data:e,template:n,mode:a,target:i}){return new on({template:n,data:e}).render({container:t,mode:a,target:i})}}const cn=Nt("app"),ln=Nt("route"),un=new class{constructor(){st(this,"weakmap",new WeakMap)}data(t){let e=this.weakmap.get(t);return e||(e={},this.weakmap.set(t,e)),e}value(t,e,n){if(2==arguments.length)return this.data(t)[e];void 0===n?delete this.data(t)[e]:this.data(t)[e]=n}destroy(){this.weakmap.delete(reference)}},hn="name",dn=[hn];class pn extends mt{static get observedAttributes(){return dn}static get NODENAME(){return de}constructor(t){super(t||{})}get name(){return this.attr(hn)}get app(){return cn(this)}set app(t){cn(this,t)}get route(){return ln(this)}async display({route:t,context:e,view:n,refresh:a=!1}){if(n)throw new Error("you must override the display function!");ln(this,t);const{root:i,app:r}=this;i.empty();let s=t.stateful?un.value(t,"component"):null;a||!s?(s=await t.component(),s instanceof Xt?(await on.render({container:i,data:{$view:this,$app:r,$store:r.store,$route:t,$context:e},template:s}),s=NodeList.from(i.childNodes)):(s instanceof pn&&(s.app=r,s.ready.then((()=>{s.display({route:t,context:e,view:this})}))),i.append(s)),t.stateful&&un.value(t,"component",s)):(s instanceof pn&&(s.app=r,s.ready.then((()=>{s.display({route:t,context:e,view:this})}))),i.append(s))}}wt(pn);const fn=pn,gn=Nt("view"),mn=Nt("store"),yn=yt("application"),wn="route",vn="view",bn=(t,e)=>{const n=`${re.NODENAME}[name="${e}"]`;return t.find(n).first()},xn=(t,e)=>{let n=null;if(e){const a=t.root.find(`d-view[name="${e}"]`).first();a&&1==a.length&&(n=a.first())}return n||(n=((t,e)=>bt(t.root,(t=>t instanceof fn&&(null==e||t.name==e))))(t,e)),n&&(n.app=t),n},En=async(t,e)=>{try{return Ut.resolve(t,e.store,null)}catch(t){return null}},An=[wn,vn];class Nn extends mt{static get observedAttributes(){return An}static get NODENAME(){return yn}constructor(t){super(t||{}),this.root.on([Mt,Ct],(async t=>{this.route({route:t.target})})),this.on(ht(wn,this),(()=>{this.hasAttribute(wn)&&this.route({route:this.attr(wn)})}))}async init(){await super.init(),this.ready.then((()=>{this.hasAttribute(wn)&&this.route({route:this.attr(wn)})}))}async routes(){return this.root.find(re.NODENAME)}async route({route:t,refresh:e=null,context:n=null,view:a=null}){if(await this.ready,0==arguments.length)return this.view.route;if("string"==typeof t)t=bn(this,t);else if(t instanceof he)e=null!=e?e:t.refresh,null==n&&(n=await En(t.context,this)),null==a&&(a=t.view),t=bn(this,t.target);else if(!(t instanceof re))throw new Error("Unsupported route type!");null==e&&(e=!1),null==a&&(a=t.view),a=a?xn(this,a):this.view,(e||a.route!=t)&&(null==n&&(n=await En(t.context,this)),a.route&&(a.route.active=!1),await a.display({route:t,context:n,refresh:e}),t.active=!0)}get view(){let t=gn(this);return t||(t=xn(this,this.attr(vn)),gn(this,t),t.app=this),t}get store(){let t=mn(this);return t||(t={},mn(this,t)),t}}wt(Nn);n(23),n(923),n(576);window.functions={calcCampaignAvailability:t=>{const{availability:e,fullyavailable:n,member:{name:a}}=t;let i=0;if(!0!==n)for(const t of e){const{available:e}=t;"partially"==e?i+=1:"none"==e&&(i+=3)}return[("000000"+i).slice(-6),a.toLowerCase()].join("::")}},window.Date.prototype.addDays=function(t){const e=new Date(this);return e.setDate(e.getDate()+t),e},"serviceWorker"in navigator&&navigator.serviceWorker.register("./serviceworker.js",{scope:"./"}).then((t=>{console.log(t),t.installing?console.log("Service worker installing"):t.waiting?console.log("Service worker installed"):t.active&&(console.log("Service worker active"),t.active.postMessage("validate-cache"))})).catch((t=>{console.log("Registration failed with "+t)}));class Tn extends(gt(HTMLDialogElement)){static get NODENAME(){return"x-dialog"}constructor(){super(),this.on("click",(t=>{const{target:e}=t;e.is("[close-modal]")&&(t.stopPropagation(),this.close())}))}async init(){await super.init()}hide(){this.close()}}wt(Tn,{extends:"dialog"});class Dn extends mt{static get NODENAME(){return"x-login-component"}constructor(){super()}async init(){await super.init();const t=await T();if(t){const e=this.attr("template");if(e){const n=await Xt.load(new URL(e,location));await on.render({container:this,data:{user:t},template:n})}}else this.textContent="kein Zugriff erlaubt"}}wt(Dn);const Mn="x-clan",Ln=new URL(`${u}/html-clan-element/root.tpl.html`,location);class Pn extends mt{static get NODENAME(){return Mn}#b=!1;#O=null;constructor(){super(),this.on(`${Mn}:sort-member-by-name`,(()=>{})),this.on(`${Mn}:sort-member-by-wtr`,(()=>{}))}async init(){if(await super.init(),!this.#b){const t=await Xt.load(Ln);await on.render({container:this.root,template:t,data:await this.clanData()})}}async clanData(){if(!this.#O){this.#O={id:this.attr("clan-id"),name:this.attr("clan-name"),tag:this.attr("clan-tag")};let t=await fetch(new URL(`/api/clans/${this.#O.id}/members`,location));t=await t.json(),this.#O.members=t.data}return this.#O}}wt(Pn);const $n=async(t,e)=>{const n=await fetch((t=>t instanceof URL?t:new URL(t,location))(t),e);return n.ok&&n.status>=400?await T():n},Cn=async t=>{const e=await $n(t,{headers:{"content-type":"application/json"}});if(e.status<204)return e.json()},On=async(t,e)=>{const n=await $n(t,{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify(e)});if(n.status<204)return n.json()},kn=async t=>{await $n(t,{method:"delete",headers:{"content-type":"application/json"}})};let Sn=0;const Rn=(()=>{let t=null;return async()=>((null==t||Sn<Date.now())&&(t=Vn(),Sn=Date.now()+36e5),await t)})(),Vn=async()=>{const t=new Map,e=(await Cn("/api/members")).data;for(const n of e)t.set(`${n.id}`,n);return t},In=async t=>{let e=(await Rn()).get(`${t}`);return e||(e=await Cn((t=>`/api/members/${t}`)(t)),e&&(Rn()[e.id]=e)),e},jn=`${u}/html-member-element`,Hn=Xt.load(new URL(`${jn}/root.tpl.html`,location));class zn extends mt{static get NODENAME(){return"x-member"}#b=!1;constructor(){super()}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}get memberId(){return parseInt(this.attr("member-id"))}async render(){const t=await Hn,e=await In(this.memberId);await on.render({container:this.root,template:t,data:{member:e}})}}wt(zn);const _n="/api/campaigns",Un=new Map,qn=async()=>{let t=null;if(0==Un.size){t=(await Cn(_n)).data;for(const e of t)Un.set(e.id,e)}else{t=[];for(const[e,n]of Un)t.push(n)}return t},Fn=async t=>{if(Un.has(t))return Un.get(t);const e=await Cn(`${_n}/${t}`);return Un.set(e.id,e),e},Gn="d-",Kn=500,Xn=`${Gn}form`,Bn=`${Gn}submit-action`,Jn=`${Gn}page`,Wn=`${Gn}field`,Zn=`${Gn}container`,Qn=`${Gn}list`,Yn=`${Gn}rows`,ta=`${Gn}row`,ea=`${Gn}add-row`,na=`${Gn}delete-row`,aa=`${Gn}progress-bar`,ia=`${Gn}step`,ra=`${Gn}validation`,sa=`${Gn}message`,oa=`${Gn}control`,ca=`${Gn}control-back`,la=`${Gn}control-next`,ua=`${Gn}control-summary`,ha=`${Gn}control-submit`,da="init",pa="validating",fa="input",ga="summary",ma="finished",ya="d-form-",wa=`${ya}initialized`,va=`${`${ya}initialize`}submit-action`,ba=`${ya}submit`,xa=`${ya}submit-results`,Ea=`${ya}condition-state-changed`,Aa=`${ya}site-changed`,Na=`${ya}state-changed`,Ta=`${ya}field-input`,Da=`${ya}list-row-add`,Ma=`${ya}list-row-delete`,La=`${ya}progress-bar-changed`,Pa=`${ya}field-initialized`,$a=`${ya}field-removed`,Ca=`${ya}page-initialized`,Oa=`${ya}page-removed`,ka=`${ya}validation-initialized`,Sa=`${ya}validation-removed`,Ra=`${ya}message-initialized`,Va=`${ya}message-removed`,Ia=`${ya}active-state-changed`,ja=`${ya}valid-state-changed`,Ha=`${ya}editable-state-changed`,za="$value",_a="$item",Ua="name",qa="endpoint",Fa="method",Ga="state",Ka="step",Xa="use-summary-page",Ba="input-mode-after-submit",Ja="required",Wa="condition",Za="active",Qa="disabled",Ya="editable",ti="editable-condition",ei="readonly",ni="no-value",ai="valid",ii="invalid",ri="evaluate",si="condition-valid",oi="condition-invalid",ci="min",li="max",ui="progress";const hi=class{#k;#d;constructor(t){this.#k=t}get condition(){return this.#d||(this.#d=this.#k.attr(Wa)||!1),this.#d}async validate(t){const e=this.#k;let n=this.condition;const a=e.condition;return n=!n||await Ut.resolve(n,t,!1),n!=a&&(e.condition=n),n}};const di=class{#k;#d=null;constructor(t){this.#k=t}get condition(){return null==this.#d&&(this.#d=this.#k.attr(ti)||""),this.#d}async validate(t){let e=!0;const n=this.#k.editable;return this.condition&&(e=await Ut.resolve(this.condition,t,!1)),e!=n&&(this.#k.editable=e),e}};const pi=class{#k;#S=new Set;#R=new Set;constructor(t){this.#k=t,t.on(ka,(t=>{t.stopPropagation(),this.#S.add(t.target)})),t.on(Sa,(t=>{t.stopPropagation(),this.#S.delete(t.target)}))}addCustomValidation(t){this.#R.add(t)}async validate(t){const e=this.#k,n=this.#R,a=this.#S,{hasValue:i,required:r,condition:s,editable:o}=(this.#k.valid,this.#k);let c=!0;if(s){c=!r||i,await(async(t,e,n)=>{let a=!0;for(let i of t)await i({data:e,base:n})||(a=!1);return a})(n,t,e)||(c=!1);for(let e of a)if(c&&i){const n=await Ut.resolve(e.condition,t,!0);e.active=!n,n||(c=!1)}else e.active=!1}return e.valid=c,c}};const fi=class{#V=new Set;constructor(t){t.on(Ra,(t=>{t.preventDefault(),t.stopPropagation();const e=t.target;this.#V.add(e)})),t.on(Va,(t=>{t.preventDefault(),t.stopPropagation();const e=t.target;this.#V.delete(e)}))}async validate(t){for(let e of this.#V)e.update(t)}},gi=t=>null==t||void 0===t,mi=async(t,e,n)=>(gi(n)||(e?vi(t,e,n):Object.assign(t,n)),t),yi=async(t,e)=>{let n={};if(e)for(let a of e){const e=a.name,i=t.get(a);n=await mi(n,e,i)}else for(let[{name:e},a]of t)n=await mi(n,e,a);return n},wi=/\./g,vi=function(t,e,n){const a=e.split(wi);if(2==arguments.length)return xi(t,a);const i=gi(n);return gi(t)&&i?t:bi(i,t,n,a)},bi=(t,e,n,a)=>{if(gi(e)&&t)return null;const i=a.shift();return 0==a.length?t?delete e[i]:e[i]=n:(gi(e[i])&&(e[i]={}),bi(t,e[i],n,a)),e},xi=(t,e)=>{if(gi(t))return null;if(0==e.length)return t;const n=e.shift();return xi(t[n],e)},Ei=(t,e,n=!1)=>{const a=t.active;e?t.attr(Za,""):t.attr(Za,null),(a!=e||n)&&t.trigger(Ia)},Ai=(t,e,n=!1)=>{const a=t.readonly;e?t.attr(ei,""):t.attr(ei,null),(a!=e||n)&&t.trigger(Ha)},Ni=Nt("form"),Ti=[Za,ei,Wa,si,oi,ti];const Di=class extends mt{static get observedAttributes(){return Ti}#I;#j;#H;#z;constructor(){super(),this.#z=new fi(this),this.#I=new hi(this),this.#j=new di(this),this.#H=new pi(this)}addValidation(t){this.#H.addCustomValidation(t)}async validate(t){this.attr(ri,"");const e=Object.assign({},t,await(async t=>{await t.ready;const e={};e[za]=Li(t);let n=t.parent(ta),a=e;for(;n;)a[_a]=await Li(n),a=a[_a],n=n.parent(ta);return e})(this));return await this.#I.validate(e),await this.#j.validate(e),await this.#H.validate(e),this.attr(ri,null),await this.#z.validate(e),this.valid}get form(){let t=Ni(this);return t||(t=this.parent(Xn),Ni(this,t)),t}get active(){return this.hasAttribute(Za)}set active(t){this.active!=t&&(Ei(this,t),this.activeUpdated())}async activeUpdated(){}get readonly(){return this.hasAttribute(ei)}set readonly(t){this.editable?Ai(this,t,!this.ready.resolved):Ai(this,!0,!this.ready.resolved),this.readonlyUpdated()}async readonlyUpdated(){}get editable(){return this.hasAttribute(Ya)}set editable(t){((t,e,n=!1)=>{const a=t.editable;e?t.attr(Ya,""):t.attr(Ya,null),(a!=e||n)&&t.trigger(Ha)})(this,t,!this.ready.resolved),this.editableUpdated(),this.readonly=!t}async editableUpdated(){}set condition(t){var e,n;e=this,void 0===(n=t)||null==n?(e.attr(oi,null),e.attr(si,null)):n?(e.attr(oi,null),e.attr(si,"")):(e.attr(si,null),e.attr(oi,"")),e.trigger(Ea),this.conditionUpdated()}get condition(){return!this.hasAttribute(oi)}async conditionUpdated(){}set valid(t){((t,e)=>{void 0===e||null==e?(t.attr(ii,null),t.attr(ai,null)):e?(t.attr(ii,null),t.attr(ai,"")):(t.attr(ii,""),t.attr(ai,null)),t.trigger(ja)})(this,t),this.validUpdated()}get valid(){return this.hasAttribute(ai)}async validUpdated(){}},Mi=Nt("parent"),Li=Nt("value"),Pi=[Ua,Ja,ni];class $i extends Di{static get observedAttributes(){return Pi.concat(Di.observedAttributes)}constructor(t={}){super(t);const{value:e}=t;Li(this,e||null)}async init(){this.ready.then((()=>this.trigger(Pa))),await super.init()}async destroy(){this.publishValue(null),await super.destroy(),this.trigger($a)}get parentField(){let t=Mi(this);return t||(t=(t=>{let e=t.parentNode;for(;e;){if(e instanceof $i)return e;e=e.parentNode}return null})(this),Mi(this,t)),t}async conditionUpdated(){return this.active=this.condition,this.publishValue()}get name(){return this.getAttribute(Ua)}get required(){return this.hasAttribute(Ja)}get hasValue(){return!this.hasAttribute(ni)}async value(t){const{condition:e,valid:n,ready:a}=this;if(0==arguments.length)return e&&n?Li(this):null;await a;const i=Li(this);if(await this.acceptValue(t)&&i!=(t=await this.normalizeValue(t)||t)){const e=await this.updatedValue(t);void 0!==e&&(t=e),await this.publishValue(t)}}async validate(t){const e=this.condition,n=this.valid,a=await super.validate(t),i=this.condition;return this.validationStateChanged(e!=i,n!=a),a}async validationStateChanged(t,e){(t||e)&&this.publishValue()}async updatedValue(t){return t}async publishValue(t){await this.ready,0==arguments.length&&(t=Li(this));const e=(t=>{if(gi(t))return!0;const e=typeof t;return"string"===e&&0==t.trim().length||!(t instanceof Date)&&(t instanceof Array&&0==t.length||t instanceof Set&&0==t.length||t instanceof Map&&0==t.length||"object"==e&&0==Object.getOwnPropertyNames(t).length)})(t),n=this.condition;var a;t=this.required&&e?null:t,n?Li(this,t):t=null,a=!e,this.attr(ni,a?null:""),this.parentField?await this.parentField.childValueChanged(this,t):this.form&&await this.form.childValueChanged(this,t)}async acceptValue(t){return!0}async normalizeValue(t){return t}async childValueChanged(t,e){}}const Ci=$i,Oi=(t,e,n,a)=>{let i=null;const r="function"==typeof e?e:()=>e,s="function"==typeof n?n:()=>n;return e=>{r(e)&&e.preventDefault(),s(e)&&e.stopPropagation();const n=(t=>({type:t.type,target:t.target,detail:t.detail,currentTarget:t.currentTarget,explicitOriginalTarget:t.explicitOriginalTarget,originalTarget:t.originalTarget,srcElement:t.srcElement,timeStamp:t.timeStamp}))(e);i&&clearTimeout(i),i=setTimeout((()=>{i=null,t(n)}),a||10)}};class ki{static findInput(t){return null}#_;constructor(t,e){this.field=t,this.input=e,this.init()}init(){}set readonly(t){}async acceptValue(t){return!0}async normalizeValue(t){return t}async updatedValue(){}get value(){return null}get valid(){return!0}}const Si="text",Ri=t=>({accept:t=>"number"==typeof t,getValue:()=>t.valueAsNumber,setValue:e=>{t.valueAsNumber=e},normalize:t=>gi(t)||Number.isNaN(t)?null:t}),Vi=t=>({accept:t=>"string"==typeof t,getValue:()=>t.value,setValue:e=>{t.value=e},normalize:t=>t||null}),Ii=new Intl.DateTimeFormat("default",{hour:"numeric",minute:"numeric"}),ji={text:t=>({accept:t=>"string"==typeof t,getValue:()=>t.value,setValue:e=>t.value=e,normalize:t=>t&&(t=t.trim()).length>0?t:null}),number:Ri,datetime:Vi,"datetime-locale":Vi,date:t=>({accept:t=>t instanceof Date,getValue:()=>t.valueAsDate,setValue:e=>{t.valueAsDate=e},normalize:t=>t||null}),time:t=>({accept:t=>t instanceof Date,getValue:()=>t.value?new Date(`1970-01-01T${t.value}`):null,setValue:e=>{t.value=Ii.format(e)},normalize:t=>t||null}),range:Ri};const Hi=Nt("value"),zi=(t,e)=>new Promise(((n,a)=>{const i=new FileReader;i.addEventListener("loadend",(()=>{n({name:t.name,type:t.type,size:t.size,data:i.result})}),!1),i[e](t)})),_i={"form-input":async t=>(t.format="form-input",t),"data-url-base64":async t=>{const e=await zi(t,"readAsDataURL");return e.format="data-url-base64",e},base64:async t=>{const e=await zi(t,"readAsDataURL");return e.data=e.data.substr(e.data.indexOf(",")+1),e.format="base64",e}},Ui=async(t,e,n)=>{let a=[];for(let n of t)a.push(await _i[e](n));return 0==a.length?null:n?a:a[0]};const qi=[class extends ki{static findInput(t){return t.find('input:not([type="file"],[type="radio"],[type="checkbox"],[type="button"],[type="submit"],[type="reset"]),input:not([type]), textarea').first()}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this,n=(t.attr("input-type")||e.attr("type")||Si).trim().toLowerCase();this.type=(ji[n]||ji[Si])(e),e.on("input",Oi((()=>{t.trigger(Ta,this.normalizeValue(this.value))}),!1,!0,Kn)),t.trigger(Ta,this.normalizeValue(this.value))}acceptValue(t){return null==t||void 0===t||this.type.accept(t)}normalizeValue(t){return null==t&&void 0===t?null:this.type.normalize(t)}async updatedValue(t){t!=this.type.getValue()&&this.type.setValue(t)}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.type.getValue()}get valid(){return this.input.checkValidity()}},class extends ki{static findInput(t){const e=t.find('input[type="checkbox"]');return 0==e.length?null:1==e.length?e.first():e}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this;this.multiple=e instanceof NodeList,e.on("input",Oi((()=>{t.trigger(Ta,this.normalizeValue(this.value))}),!1,!0,Kn)),t.trigger(Ta,this.normalizeValue(this.value))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){const t=this.input.val();if(!(t instanceof Map))return t;if(0==t.size)return null;const e=[];return t.forEach((t=>{e.push(t)})),e}normalizeValue(t){return t?this.multiple?0!=(t=t.filter((t=>!!t))).length?t:null:t:null}acceptValue(t){if(null==t||void 0===t)return!0;if(this.multiple)return t instanceof Array;{const e=typeof t;return"string"===e||"boolean"===e}}updatedValue(t){this.input.val(t||null)}},class extends ki{static findInput(t){const e=t.find('input[type="radio"]');return 0==e.length?null:e}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this,n=t.name+Math.floor(Math.random()*Date.now());for(let t of e)t.name=n;e.on("input",Oi((()=>{t.trigger(Ta,this.normalizeValue(this.value))}),!1,!0,Kn)),t.trigger(Ta,this.normalizeValue(this.value))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){const t=this.input.val();return t instanceof Map?0==t.size?null:t.values().next().value:t}normalizeValue(t){return t||null}acceptValue(t){if(null==t||void 0===t)return!0;{const e=typeof t;return"string"===e||"boolean"===e}}updatedValue(t){this.input.val(t||null)}},class extends ki{static findInput(t){return t.find('input[type="file"]').first()}constructor(t,e){super(t,e)}async init(){const{field:t,input:e}=this;this.multiple=e.multiple,this.format=t.attr("file-format")||"form-input",this.filenameTarget=t.attr("file-name-target"),this.filenameTarget=this.filenameTarget?t.find(this.filenameTarget).first():null;const{format:n,multiple:a}=this;e.on("input",Oi((async()=>{this.updatedValue(await Ui(e.files,n,a)),t.trigger(Ta,this.value)}),!1,!0)),e.files&&0!=e.files.length&&this.updatedValue(await Ui(e.files,n,a)),t.trigger(Ta,this.value)}set readonly(t){this.input.attr("disabled",t?"":null)}acceptValue(t){return null==t||void 0===t||(this.multiple?t instanceof Array:"object"==typeof t)}normalizeValue(t){return null==t||void 0===t?null:this.multiple?0!=t.length?t:null:t}updatedValue(t){if(t!=Hi(this)){Hi(this,t),t||(this.input.value=null);const e=this.filenameTarget;if(e&&(e.empty(),t))if(this.multiple)for(let n of t)e.append(`<span>${n.name}</span>`);else e.append(`<span>${t.name}</span>`)}}get value(){return Hi(this)}get valid(){return this.input.checkValidity()}},class extends ki{static findInput(t){return t.find("select").first()}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this;e.on("input, changed",Oi((()=>{t.trigger(Ta,this.value)}),!1,!0,Kn))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.normalizeValue(this.input.multiple?this.input.val():this.input.value)}normalizeValue(t){return t?this.input.multiple?0!=(t=t.filter((t=>t&&t.trim().length>0))).length?t:null:0!=(t=t.trim()).length?t:null:null}acceptValue(t){return null==t||void 0===t||(this.input.multiple?t instanceof Array:"string"==typeof t)}updatedValue(t){const e=this.input.val();this.field.value!=this.value&&this.input.val(t||e)}}],Fi=["file-format"];class Gi extends Ci{static get observedAttributes(){return Fi.concat(Ci.observedAttributes)}static get NODENAME(){return Wn}#b=!1;#U;constructor(t){super(t),this.on(Ta,(t=>{t.preventDefault(),t.stopPropagation(),this.publishValue(t.detail||null)}))}async init(){await super.init(),this.#b||(this.#b=!0,this.#U=(t=>{for(let e of qi){const n=e.findInput(t);if(n)return new e(t,n)}return null})(this),this.#U&&(this.addValidation((async()=>this.#U.valid)),this.publishValue(this.#U.value)))}readonlyUpdated(){this.#U&&(this.#U.readonly=this.readonly)}async acceptValue(t){return!!this.#U&&this.#U.acceptValue(t)}async normalizeValue(t){return this.#U?this.#U.normalizeValue(t):t}async updatedValue(t){await this.ready,t=await t;const e=this.#U;if(e){(e.value||null)!=t&&await e.updatedValue(t)}await super.updatedValue(t)}async validationStateChanged(t,e){if(t&&this.condition){const t=this.#U.value||null;Li(this,t)}return super.validationStateChanged(t,e)}}wt(Gi);const Ki=[Za,Wa];class Xi extends mt{static get observedAttributes(){return Ki}static get NODENAME(){return ra}constructor(){super()}async init(){await super.init(),this.active=!1,this.ready.then((()=>this.trigger(ka)))}async destroy(){this.trigger(Sa),await super.destroy()}get active(){return this.hasAttribute(Za)}set active(t){t?this.attr(Za,""):this.attr(Za,void 0)}get condition(){return this.attr(Wa)}}wt(Xi);const Bi=({root:t,filter:e})=>{let n=[];return t.children.forEach((t=>{const{accept:a,stop:i=!1}=e(t);if(a&&n.push(t),!i){const a=Bi({root:t,filter:e});a instanceof Array?n=n.concat(a):a&&n.push(a)}})),n},Ji=async(t,e)=>(await Promise.all(e.map((e=>e.validate(t))))).reduce(((t,e)=>!!t&&e),!0),Wi=[];class Zi extends Ci{static get observedAttributes(){return Wi.concat(Ci.observedAttributes)}static get NODENAME(){return Zn}#q=null;#F=new Map;constructor(t){super(t);const e=this.root;e.on(Pa,(t=>{const e=t.target;e!=this&&(!(e instanceof Ci)||this.#q&&this.#q.has(e)||(this.#q=null),t.stopPropagation())})),e.on($a,(t=>{const e=t.target;e!=this&&(e instanceof Ci&&this.#q&&this.#q.has(e)&&this.#q.delete(e),t.stopPropagation())})),this.addValidation((async({data:t})=>await Ji(t,this.fields)))}get fields(){return this.#q||(this.#q=new Set(Bi({root:this,filter:t=>t instanceof Ci?{accept:!0,stop:!0}:{accept:!1}}))),Array.from(this.#q)}readonlyUpdated(){const{readonly:t,fields:e}=this;if(e)for(let n of e)n.readonly=t}async updatedValue(t){await this.ready;const e=this.#F;e.clear();const n=this.fields;n&&await Promise.all(n.map((async n=>{const a=n.name?vi(t,n.name):t;gi(a)||e.set(n,a),await n.value(a)})));let a=await yi(this.#F,n);return 0==Object.getOwnPropertyNames(a).length&&(a=null),a}async childValueChanged(t,e){e=await e;const n=this.#F;if(t){const a=n.has(t),i=n.get(t);if(a&&i==e)return;gi(e)?n.delete(t):n.set(t,e)}let a=await yi(n,this.fields);0==Object.getOwnPropertyNames(a).length&&(a=null),await this.publishValue(a)}}wt(Zi);const Qi=Zi,Yi=[Za,Qa];const tr=class extends mt{static get observedAttributes(){return Yi}#b=!1;#G;constructor(){super(),this.on("click",(t=>{t.preventDefault(),t.stopPropagation(),this.active&&!this.disabled&&this.execute()}))}async init(){await super.init(),this.#b&&(this.active=!1,this.disabled=!1,this.#b=!0)}get form(){return this.#G||(this.#G=this.parent(Xn)),this.#G}get active(){return this.hasAttribute(Za)}set active(t){this.attr(Za,t?"":null)}get disabled(){return this.hasAttribute(Qa)}set disabled(t){this.attr(Qa,t?"":null)}execute(){console.log("execute")}},er=[];class nr extends tr{static get observedAttributes(){return er.concat(er)}static get NODENAME(){return na}constructor(){super()}async init(){await super.init(),this.active=!0}execute(){this.trigger(Ma)}}wt(nr);const ar=[];class ir extends Qi{static get observedAttributes(){return ar.concat(Qi.observedAttributes)}static get NODENAME(){return ta}constructor(t){super(t)}get active(){return!0}set active(t){}get condition(){return!0}get name(){return null}}customElements.define(ir.NODENAME,ir);const rr=`${ea}:initialized`,sr=[];class or extends tr{static get observedAttributes(){return sr.concat(sr)}static get NODENAME(){return ea}constructor(){super(),this.ready.then((()=>this.trigger(rr)))}async init(){await super.init(),this.active=!0}execute(){this.trigger(Da)}}wt(or);const cr=[];class lr extends mt{static get observedAttributes(){return cr}static get NODENAME(){return Yn}constructor(){super()}}wt(lr);const ur=[ci,li],hr=async(t,e)=>{let n=[];for(let a of t)n.push(e.get(a));return 0==n.length&&(n=null),n};class dr extends Ci{static get observedAttributes(){return ur.concat(Ci.observedAttributes)}static get NODENAME(){return Qn}#D;#K;#X=new Map;#B;#b=!1;constructor(t){super(t);const e=this.root;e.on(rr,(t=>{this.#B=t.target,t.stopPropagation()})),e.on(Pa,(t=>{t.target!=this&&(t.preventDefault(),t.stopPropagation())})),e.on(Da,(t=>{t.preventDefault(),t.stopPropagation();const{readonly:e}=this;e||this.createRow()})),e.on(Ma,(t=>{t.preventDefault(),t.stopPropagation();const{rows:e,readonly:n}=this;if(!n){const n=t.target.parent(ta);e.indexOf(n)>=0&&n.remove()}})),this.addValidation((async()=>{const{rows:t,min:e,max:n,readonly:a}=this,i=t.length;return this.#B&&!a&&(i==n?this.#B.disabled=!0:i<n&&(this.#B.disabled=!1)),e<=i&&i<=n})),this.addValidation((async t=>await Ji(t,this.rows)))}async init(){if(await super.init(),!this.#b){this.#b=!0;const t=this.find("template").first();t&&(this.#D=t.content),this.#K=this.find(Yn).first()}}readonlyUpdated(){const{readonly:t}=this;for(let e of this.rows)e.readonly=t}get rows(){return this.#K?Array.from(this.#K.children):[]}get min(){return this.hasAttribute(ci)?Math.max(0,parseInt(this.attr(ci))):0}get max(){return this.hasAttribute(li)?parseInt(this.attr(li)):Number.MAX_SAFE_INTEGER}acceptValue(t){return!t||t instanceof Array}normalizeValue(t){return t?t.filter((t=>!!t)):null}async createRow(t){const e=document.importNode(this.#D,!0).children[0];return await this.#K.append(e),t&&await e.value(t),e}async updatedValue(t){return this.#X.clear(),this.#K.empty(),t&&await Promise.all(t.map((t=>this.createRow(t)))),await hr(this.rows,this.#X)}async childValueChanged(t,e){e=await e;const n=this.#X;gi(e)?this.#X.delete(t):this.#X.set(t,e),await super.childValueChanged(t,e);const a=await hr(this.rows,n);await this.publishValue(a)}}wt(dr);const pr=[Ka];class fr extends Qi{static get observedAttributes(){return pr.concat(Qi.observedAttributes)}static get NODENAME(){return Jn}constructor(t){super(t),this.ready.then((()=>this.trigger(Ca)))}async destroy(){this.trigger(Oa),await super.destroy()}get step(){return this.attr(Ka)}conditionUpdated(){}}wt(fr);const gr="active",mr="condition",yr=[gr,mr];class wr extends mt{static get observedAttributes(){return yr}static get NODENAME(){return sa}constructor(){super()}async init(){await super.init(),this.trigger(Ra)}async destroy(){this.trigger(Va),await super.destroy()}get active(){return this.hasAttribute(gr)}set active(t){t?this.attr(gr,""):this.attr(gr,void 0)}get condition(){return this.attr(mr)}async update(t){await this.ready,this.active=await Ut.resolve(this.condition,t,!1)}}wt(wr);const vr=[];class br extends tr{static get observedAttributes(){return vr}static get NODENAME(){return ca}constructor(){super()}execute(){this.form.toPrevPage()}}wt(br);const xr=[];class Er extends tr{static get observedAttributes(){return xr}static get NODENAME(){return la}constructor(){super()}execute(){this.form.toNextPage()}}wt(Er);const Ar=[];class Nr extends tr{static get observedAttributes(){return Ar}static get NODENAME(){return ua}constructor(){super()}execute(){this.form.toNextPage()}}wt(Nr);const Tr=[];class Dr extends tr{static get observedAttributes(){return Tr}static get NODENAME(){return ha}constructor(){super()}execute(){this.form.submit()}}wt(Dr);const Mr={active:!0,disabled:!0},Lr=[];class Pr extends mt{static get observedAttributes(){return Lr}static get NODENAME(){return oa}#G;#J;#W;#Z;#Q;#b=!1;constructor(){super()}async init(){await super.init(),this.#b||(this.#G=this.parent(Xn),this.#J=this.find(ca).first()||Mr,this.#W=this.find(la).first()||Mr,this.#Z=this.find(ua).first()||Mr,this.#Q=this.find(ha).first()||Mr,this.#G.on([wa,Na,Aa],(()=>{this.update()})),this.#b=!0)}async update(){const t=this.#G,e=t.state,n=this.#J,a=this.#W,i=this.#Z,r=this.#Q;if(n.active=!0,n.disabled=!0,a.active=!1,a.disabled=!0,i.active=!1,i.disabled=!0,r.active=!1,r.disabled=!0,e==pa)return;const{activePageIndex:s,activePage:o,nextPage:c,pages:l,useSummaryPage:u}=t,h=null!=await c;e==ma?(n.disabled=!0,r.active=!0):e==ga?(n.disabled=!1,r.active=!0,r.disabled=!t.valid):e==fa&&(n.disabled=s<=0,h||!o.valid&&s+1<l.length?(a.active=!0,a.disabled=!o.valid):u&&e==fa?(i.active=!0,i.disabled=!o.valid):(r.active=!0,r.disabled=!t.valid))}}wt(Pr);const $r=[Ua,Za,ei];class Cr extends mt{static get observedAttributes(){return $r}static get NODENAME(){return ia}constructor(){super()}get name(){return this.attr(Ua)}get active(){return this.hasAttribute(Za)}set active(t){this.active!=t&&Ei(this,t)}get readonly(){return this.hasAttribute(ei)}set readonly(t){t?this.attr(ei,""):this.attr(ei,null)}}wt(Cr);const Or=[ui];class kr extends mt{static get observedAttributes(){return Or}static get NODENAME(){return aa}#G;#Y;#b=!1;constructor(){super(),this.on("click",(({target:t})=>{if(!this.#G)return;if(t==this)return;const e=t.is(ia)?t:t.parent(ia),n=this.#G;if(!e)return;const{state:a,pages:i,activePage:r}=n,s=e.name;if(a==fa||a==ga){const t=((t,e,n)=>{for(let a of t){if(a.step==e&&a.condition)return a;if(a==n)return}return null})(i,s,r);t&&(n.activePage=t)}}))}async init(){if(await super.init(),this.progress=0,!this.#b){const t=this.#G=this.parent(Xn);this.#Y=this.find(ia),this.#G.on([Aa,Na],(()=>{const e=t.state;if(pa==e)return;const{activePageIndex:n,activePage:a,pages:i}=t;if(!a)return;const r=i.length,s=a?a.step:da,o=Math.floor(100*n/r);for(let t of this.steps){const n=t.name;e==fa?(t.active=n==s,t.readonly=!1):e==ga?(t.active=n==ga,t.readonly=!1):(t.active=n==ma,t.readonly=!0)}this.progress=e==ga||e==ma?100:o,this.trigger(La)})),this.#b=!0}}get steps(){return Array.from(this.#Y)}get progress(){return this.attr(ui)}set progress(t){this.style.setProperty&&this.style.setProperty("--progress",t+"%"),this.attr(ui,Math.max(0,Math.min(t,100)))}}wt(kr);const Sr="success",Rr="fail";const Vr=class{static get STATE_SUCCESS(){return Sr}static get STATE_FAIL(){return Rr}constructor(t,e,n,a){this.action=t,this.state=e,this.message=n,this.data=a}},Ir=Nt("form");const jr=class extends mt{constructor(){super()}async init(){await super.init();const t=this.parent(Xn);Ir(this,t),t&&this.trigger(va)}get form(){return Ir(this)}async accept(t={}){const e=this.attr(Wa);return!e||await Ut.resolve(e,t,!1)}async execute(t={}){return new Vr(Rr,"not implemented")}},Hr=`${Bn}-default`;class zr extends jr{static get NODENAME(){return Hr}constructor(t,e){super(),this.endpoint=t,this.method=e}async execute(t){let e=this.endpoint;e=await Ut.resolveText(e,t,e);const n=new URL(e,location),a=await fetch(n,{method:this.method,credentials:"include",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify(t)});return new Vr(this,a.ok?Sr:Rr,a)}}wt(zr);const _r=zr,Ur=Nt("submitAction"),qr=[Ua,Xa,qa,Fa,Ga,Ba],Fr=(t,e)=>{for(let n of t.pages)n.readonly=e,n.active=e};class Gr extends mt{static get observedAttributes(){return qr}static get NODENAME(){return Xn}#b=!1;#tt=da;#et;#F=new Map;#nt={};#at=null;#it=!1;constructor(){super();const t=this.root;t.on(Ca,(t=>{t.preventDefault(),t.stopPropagation()})),t.on(Oa,(t=>{const e=t.target;this.#et=null,this.childValueChanged(e,null),t.preventDefault(),t.stopPropagation()})),this.ready.then((()=>this.trigger(wa)))}async init(){await super.init(),this.#b||(this.#b=!0,this.activePageIndex=-1,this.state=da,this.useSummaryPage=this.hasAttribute(Xa),this.activePageIndex=-1,this.pages.length>0&&this.toNextPage())}get pages(){return this.#et||(this.#et=Array.from(this.root.find(Jn))),this.#et}get state(){return this.#tt}set state(t){const e=this.#tt;t!=pa&&(e==fa&&t!=fa?Fr(this,!0):e!=fa&&t==fa&&(Fr(this,!1),this.activePage&&(this.activePage.active=!0))),this.#tt=t,e!=t&&this.trigger(Na),this.attr(Ga,t)}get valid(){for(let t of this.pages)if(t.condition&&!t.valid)return!1;return!0}async value(t){return await this.ready,this.#at&&await this.#at,0==arguments.length?this.#nt:this.state!=fa?new Promise((e=>{const n=a=>{a.stopPropagation(),this.removeOn(n,Na),e(this.value(t))};this.on(Na,n)})):(await Promise.all(this.pages.map((e=>{const n=e.name;return n?e.value(vi(t,n)):e.value(t)}))),void await this.#rt())}get activePage(){return 0<=this.activePageIndex&&this.activePageIndex<this.pages.length?this.pages[this.activePageIndex]:null}set activePage(t){const e=this.activePage;t==e&&this.state==fa||(e&&(e.active=!1),this.activePageIndex=this.pages.indexOf(t),t.active=!0,this.state!=fa&&(this.state=fa),this.scrollIntoView(),this.trigger(Aa))}get prevPage(){return(async()=>{const t=this.pages,e=this.activePageIndex-1,n=await this.value();for(let a=e;a>=0;a--){const e=t[a];if(await e.validate(n),e.condition)return e}return null})()}get nextPage(){return(async()=>{const t=this.pages,e=this.activePageIndex+1,n=await this.value();if(t)for(let a=e;a<t.length;a++){const e=t[a];if(await e.validate(n),e.condition)return e}return null})()}async toPrevPage(){if(this.state!=fa)this.state=fa;else{const t=await this.prevPage;t&&(this.activePage=t)}}async toNextPage(){const t=await this.nextPage;t?(this.activePage=t,this.state=fa):this.useSummaryPage?this.summary():this.submit()}async summary(){this.state=ga}get submitActions(){let t=Ur(this);if(!t){t=[];let e=this.attr(qa);if(e){const t=this.attr(Fa)||"post";this.append(new _r(e,t))}const n=this.children;for(let e of n)e instanceof jr&&t.push(e);Ur(this,t)}return t}async submit(){const t=await this.value();if(!await Ji(t,this.pages))return;this.hasAttribute(Ba)||(this.state=ma);const e=this.submitActions;if(e){const n=await(async(t,e)=>{const n=[];for(let a of t)if(await a.accept(e))try{const t=await a.execute(e)||new Vr(a,Sr);if(n.push(t),t.state==Rr)return n}catch(t){return n.push(new Vr(a,Rr,t)),n}return n})(e,t);this.trigger(xa,n)}this.trigger(ba,t)}#rt(t){if(this.state==fa)return this.state=pa,this.#at=new Promise((e=>{setTimeout((async()=>{const n=this.#nt,a=t?t.validate(n):await Ji(n,this.pages);this.#it||(this.state=fa),this.validation=null,e(a)}),10)}));this.state==pa&&this.#at.then((async()=>{this.#it=!1,await this.#rt(t)}))}async childValueChanged(t,e){await this.ready,e=await e;const n=this.#F;t&&(gi(e)?n.delete(t):n.set(t,e)),this.#nt=await yi(this.#F,this.pages);const a=this.activePage;a?await this.#rt(a):await this.#rt()}}wt(Gr);const Kr=`${u}/html-campaigns-element`,Xr=new URL(`${Kr}/root.tpl.html`,location),Br=new URL(`${Kr}/campaign-dialog.tpl.html`,location);class Jr extends mt{static get NODENAME(){return"x-campaigns"}#b=!1;#st;constructor(){super();const t=this.root;t.on(h,(t=>{t.stopPropagation(),this.render()})),t.on("action:create-campaign",(t=>{t.stopPropagation(),this.openCreateDialog()})),t.on("action:close-campaign-dialog",(t=>{t.stopPropagation(),this.#st&&this.#st.close()}))}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}async render(){const t=await Xt.load(Xr);await on.render({container:this.root,template:t,data:{accessRights:D(),campaigns:await qn()}})}async openCreateDialog(){const t=this.root;if(!this.#st){const e=await Xt.load(Br),n=await on.render({template:e,container:t,data:{accessRights:D()},mode:"append"});this.#st=n.content[0],this.#st.on("d-form-submit",(t=>{t.preventDefault(),t.stopPropagation();const e=t.target;(async()=>{const t=await e.value();await(async t=>(t=await On(`${_n}`,t),Un.set(t.id,t),t))(t),this.#st.close(),await this.render()})()}))}this.#st.showModal()}}wt(Jr);class Wr{#ot;#nt=null;#ct;#lt;constructor(t,e,n=Number.MAX_SAFE_INTEGER){this.#ot=t,this.#nt=e,this.#ct=n,this.#lt=Date.now()+n}get key(){return this.#ot}get data(){return this.#nt}set data(t){this.#nt=t,this.#lt=Date.now()+this.#ct}get expireAt(){return this.#lt}}const Zr=t=>`/api/campaigns/${t}/registrations`,Qr=new class{#ct=Number.MAX_SAFE_INTEGER;#ut=new Map;constructor(t){this.#ct=t}#ht(t){return t.expireAt<Date.now()+6e4}#dt(t){const e=this.#ut.get(t);return!e||this.#ht(e)?(this.delete(t),null):e}#pt(){const t=Array.from(this.#ut.values),e=new Array;for(const n in t)this.#ht(n)||e.push(n);return e}keys(){return this.#pt().map((t=>t.key))}values(){return this.#pt().map((t=>t.data))}get size(){return this.#ut.size}get value(){return this.#ut.values}has(t){return null!=this.#dt(t)}get(t){const e=this.#dt(t);return e?e.data:null}set(t,e){const n=this.#dt(t);null!=n?n.data=e:this.#ut.set(t,new Wr(t,e,this.#ct))}delete(t){this.#ut.delete(t)}clear(){this.#ut.clear()}}(6e5),Yr=async(t,e)=>{const{memberid:n}=e,a=await In(n);a&&(e.member=a,t.set(`${n}`,e))},ts=t=>{const e=`${t}`;let n=Qr.get(e)||null;return n||(n=(async t=>{const e=new Map,n=(await Cn(Zr(t))).data||[];return await Promise.all(n.map((async t=>Yr(e,t)))),e})(t),Qr.set(e,n)),n},es=async t=>{const e=await ts(t);return Array.from(e.values()).sort(((t,e)=>t.member.name.toLowerCase()<e.member.name.toLowerCase()?-1:t.member.name.toLowerCase()>e.member.name.toLowerCase()?1:0))},ns=async(t,e)=>(e=await On(Zr(t),e),await(async t=>{if(!t)return;const{campaignid:e}=t,n=await ts(e);Yr(n,t)})(e),e),as=async t=>is(t,m.id),is=async(t,e)=>(await ts(t)).get(`${e}`),rs=`${u}/html-campaign-element`,ss=Xt.load(new URL(`${rs}/root.tpl.html`,location)),os=Xt.load(new URL(`${rs}/registration.tpl.html`,location)),cs=Xt.load(new URL(`${rs}/registrations.tpl.html`,location)),ls=(t,e)=>{t=t instanceof Date?t:new Date(t),e=e instanceof Date?e:new Date(e);const n=Math.ceil(Math.abs(t-e)/864e5),a=[];for(let e=0;e<n;e++)a.push(t.addDays(e));return a};class us extends mt{static get NODENAME(){return"x-campaign"}#b=!1;#ft=!1;constructor(){super();const t=this.root;t.on(h,(t=>{t.stopPropagation(),this.render()})),t.on("action:toogle-details",(t=>{t.stopPropagation();const{target:e}=t;e instanceof HTMLDetailsElement&&(this.#ft=e.open)})),t.on("action:show-registrations",(t=>{t.stopPropagation(),this.showRegistrations()})),t.on("action:delete-campaign",(t=>{t.stopPropagation(),(async()=>{confirm("Soll die Kampagne wirklich gelöscht werden?")&&(await(async t=>{await kn(`${_n}/${t}`),Un.delete(t)})(this.campaignId),this.remove())})()})),t.on("action:member-registrate",(t=>{t.stopPropagation(),this.openRegistrationDialog()}))}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}get campaignId(){return parseInt(this.attr("campaign-id"))}async render(){const t=await ss;await on.render({container:this.root,template:t,data:{accessRights:D(),open:this.#ft,campaign:await Fn(this.campaignId)}})}async openRegistrationDialog(){const t=await os,e=await Fn(this.campaignId),n={campaign:e,days:ls(e.startdate,e.enddate)},a=(await on.render({template:t,container:this.root,data:n,mode:"append"})).content[0],i=a.find("d-form").first();i.on("d-form-submit",(t=>{console.log(t),t.stopPropagation(),(async()=>{const t=await i.value(),e=[];let n=!0;for(const a in t)n&&"full"!=t[a].available&&(n=!1),e.push(t[a]);await ns(this.campaignId,{fullyavailable:n,availability:e}),a.hide(),a.remove()})()})),i.on("action:close-registration-dialog",(t=>{t.stopPropagation(),a.hide(),a.remove()}));const r=await as(this.campaignId);if(r){const t=r.availability||[],e={};for(let n=0;n<t.length;n++)e[`day${n+1}`]=t[n];await i.value(e)}a.showModal()}async showRegistrations(){const t=await cs,e=await es(this.campaignId),n=(await on.render({container:this,template:t,data:{registrations:e},mode:"append"})).content[0];n.on("close",(()=>{n.remove()})),n.showModal()}}wt(us);const hs=`${u}/html-campaign-member-element`,ds=Xt.load(new URL(`${hs}/root.tpl.html`,location));class ps extends mt{static get NODENAME(){return"x-campaign-member"}#b=!1;constructor(){super()}async init(){await super.init(),this.#b||(this.#b=!0,this.render())}async render(){const t=await ds,e=await this.getRegistration();await on.render({container:this.root,template:t,data:{registration:e}})}get campaignid(){return this.attr("campaign-id")}get memberid(){return this.attr("member-id")}async getRegistration(){const{campaignid:t,memberid:e}=this;return await is(t,e)}}wt(ps);const fs="/api/teams",gs=new Map,ms=new Map,ys=(t=null,e=!1)=>{const n=`${t||-1}`;if(ms.has(n))return ms.get(n);if(!e)return null;const a=new Map;return ms.set(n,a),a},ws=async t=>{if(gs.has(t))return gs.get(t);const e=await Cn(`${fs}/${t}`);gs.set(e.id,e);return ys(e.campaignid,!0).set(e.id,e),e},vs=async t=>{t=await On(`${fs}`,t),gs.set(t.id,t);return ys(t.campaignid,!0).set(t.id,t),t},bs=`${u}/html-team-element`,xs=Xt.load(new URL(`${bs}/root.tpl.html`,location)),Es=Xt.load(new URL(`${bs}/editor.tpl.html`,location));class As extends mt{static get NODENAME(){return"x-team"}#b=!1;#ft=!1;constructor(){super();const t=this.root;t.on("action:toogle-details",(t=>{t.stopPropagation();const{target:e}=t;e instanceof HTMLDetailsElement&&(this.#ft=e.open)})),t.on("action:delete-team",(t=>{t.stopPropagation(),(async()=>{if(confirm("Soll das Team wirklich gelöscht werden?")){const t=this.teamId;await(async t=>{await kn(`${fs}/${t}`);const e=gs.get(t),n=ys(e.campaignid,!1);n&&n.delete(t),gs.delete(t)})(t),this.trigger("info:team-deleted",t),this.remove()}})()})),t.on("action:edit-team",(t=>{t.stopPropagation(),this.editorDialog()}))}async init(){await super.init(),this.#b||(this.render(),this.#b=!0)}get teamId(){return parseInt(this.attr("team-id"))}get campaignId(){return parseInt(this.attr("campaign-id"))}async render(){const t=await xs,e=await ws(this.teamId);await on.render({template:t,container:this.root,data:{accessRights:D(),open:this.#ft,team:e}})}async editorDialog(){const{root:t,teamId:e}=this,n=await ws(e),a=await Es,i=document.createElement("div");await on.render({container:i,template:a,data:{team:n}}),t.append(i.innerHTML);const r=t.find(":scope > dialog").last();r.on("d-form-submit",(t=>{t.stopPropagation();const e=t.target;(async()=>{const t=await e.value();await vs(t),r.close(),r.remove(),this.render()})()})),r.on("close",(t=>{t.stopPropagation(),r.remove()}));const s=r.find("d-form").first();await s.ready,await s.value(n),r.showModal()}}wt(As);const Ns=`${u}/html-teams-element`,Ts=Xt.load(new URL(`${Ns}/root.tpl.html`,location));class Ds extends mt{static get NODENAME(){return"x-teams"}#b=!1;constructor(){super();this.root.on("action:create-team",(t=>{t.stopPropagation(),(async()=>{const t=this.campaignId?parseInt(this.campaignId):null;await vs({name:"neues Team",campaignid:t}),this.render()})()}))}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}get campaignId(){return this.attr("campaign-id")}async render(){const t=await Ts,e=await(async(t=null)=>{let e=ys(t);if(e)return Array.from(e.values());e=ys(t,!0);const n=(await(async()=>Cn(t?`${fs}/campaign/${t}`:fs))()).data;for(let t of n)e.set(t.id,t),gs.set(t.id,t);return n})(this.campaignId);await on.render({template:t,container:this.root,data:{accessRights:D(),teams:e}})}}wt(Ds);const Ms=`${u}/html-team-member-search-field-element`,Ls=Xt.load(new URL(`${Ms}/root.tpl.html`,location)),Ps=Xt.load(new URL(`${Ms}/dialog.tpl.html`,location));class $s extends Ci{static get NODENAME(){return"x-team-member-search-field"}#b=!1;#gt=null;constructor(){super();const t=this.root;t.on("action:show-selection-dialog",(t=>{t.stopPropagation(),this.readonly||this.showSelectionDialog()})),t.on("action:save-selection",(t=>{t.stopPropagation(),this.readonly||(async()=>{const t=this.#gt.find(".is-selected[member-id]"),e=await Promise.all(t.map((t=>t.attr("member-id"))));await this.publishValue(e||null),await this.render(),this.#gt.close(),this.#gt.remove(),this.#gt=null})()})),t.on("action:filter",(t=>{t.stopPropagation();const e=t.target,n=e.value,a=e.find(e.attr("filter-container")).first();a.find("[filterable]").removeClass("hidden"),n.length>0&&a.find("[filterable]").forEach((t=>{t.find("x-member[filterable-content]").first().attr("filterable-content").search(n)<0&&t.addClass("hidden")}))}))}async init(){await super.init(),this.#b||this.render()}async showSelectionDialog(){if(!this.#gt){const{root:t}=this,e=await Ps,n=await(async()=>{const t=new Set,e=await this.value();if(e)for(const n of e)t.add(n);return t})(),a=this.campaignid,i=await(async()=>a?(await es(a)).map((t=>({id:t.memberid}))):(async()=>{const t=await Rn();return Array.from(t.values()).sort(((t,e)=>t.name.toLowerCase()<e.name.toLowerCase()?-1:t.name.toLowerCase()>e.name.toLowerCase()?1:0))})())();await on.render({template:e,container:t,data:{members:i,memberids:n,campaignid:a},mode:"append"}),this.#gt=t.find(":scope > dialog").first()}this.#gt.showModal()}async render(t){t=t||await this.value();const e=await Ls;on.render({template:e,container:this.root,data:{memberids:t||[],campaignid:this.campaignid}})}get campaignid(){return this.attr("campaign-id")}async acceptValue(t){return t instanceof Array||null==t}async readonlyUpdated(){}async updatedValue(t){this.#gt&&this.#gt.remove(),await this.render(t)}}wt($s);(t=>{const e=(t=new Date)=>{const e=t.getFullYear(),n=t.getMonth();return{date:t=t.getDate(),month:n,year:e,test:1e4*e+100*n+t}},n=(t,n)=>(t=e(t instanceof Date?t:Date.parse(t)),n=e(n instanceof Date?n:Date.parse(n)),t.test>=n.test);t.formUtils=t.formUtils||{date:{greaterEqual:n,greaterEqualNow:t=>n(t,new Date),greater:(t,n)=>(t=e(t instanceof Date?t:Date.parse(t)),n=e(n instanceof Date?n:Date.parse(n)),t.test>n.test)}}})(window),(t=>{const e=new Intl.DateTimeFormat("default",{weekday:"long",month:"long",day:"numeric"});t.DateFormats=t.DateFormats||{toDate:(t=new Date)=>e.format(t)}})(window);document.body.on("action:management:sync-all-data",(async t=>{console.log({event:t}),await fetch("/api/management/sync-data",location)}))})()})();
//# sourceMappingURL=index.5ff3a1523a1206d7d5d8.min.js.map